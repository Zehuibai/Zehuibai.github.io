<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title> Forest Plot and Meta Analysis</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Zehui Bai</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="02-Clinical_Experience.html">
    <span class="fa fa-user"></span>
     
    Clinical Experience
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-sliders"></span>
     
    Sample Size
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="03-SSC-Everything-to-Know-About-Sample-Size-Determination.html">Everything to Know About Sample Size Determination</a>
    </li>
    <li>
      <a href="03-SSC-Choosing-the-Effect-Size-for-Sample-Size-Calculations.html">Choosing the Effect Size</a>
    </li>
    <li>
      <a href="03-SSC-Biosimilar-Trials.html">Statistical Considerations for the Design and Analysis of Biosimilar Trials</a>
    </li>
    <li>
      <a href="03-SSC-Sample-Size-and-Power-for-Non-Parametric-Analysis.html">Sample Size and Power for Non-Parametric Analysis</a>
    </li>
    <li>
      <a href="03-SSC-Power-for-Complex-Hypotheses.html">Power for Complex Hypotheses</a>
    </li>
    <li>
      <a href="03-SSC-Alternatives-to-Power.html">Bayesian methods - Alternatives to Power</a>
    </li>
    <li>
      <a href="03-SSC-Sample-Size-for-Pilot-Studies.html">Sample Size for Pilot Studies</a>
    </li>
    <li>
      <a href="03-SSC-Case-Continuous-Endpoint.html">Sample Size Determination for Continuous Endpoint</a>
    </li>
    <li>
      <a href="03-SSC-Case-Categorical-Endpoint.html">Sample Size Determination for Categorical Endpoint</a>
    </li>
    <li>
      <a href="03-SSC-Sample-Size-Determination-for-Counts-and-Rates.html">Sample Size Determination for Counts and Rates</a>
    </li>
    <li>
      <a href="03-SSC-Case-Survival-Endpoint.html">Sample Size Determination for Survival Endpoint</a>
    </li>
    <li>
      <a href="03-SSC-Case-Repeated-Measures.html">Sample Size Determination for Repeated Measures</a>
    </li>
    <li>
      <a href="03-SSC-IA-Sequential-Design.html">Statistical Considerations for Group Sequential Design</a>
    </li>
    <li>
      <a href="03-SSC-IA-Adaptive-Design.html">Statistical Considerations for Adaptive Design</a>
    </li>
    <li>
      <a href="03-SSC-Multiple-Test.html">Sample Size for Multiple Test</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-pencil-square-o"></span>
     
    Study Design
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="04-Design-Estimands-Framework.html">Estimands Framework</a>
    </li>
    <li>
      <a href="04-Design-Estimands-Practice.html">Estimands and Sensitivity Analyses</a>
    </li>
    <li>
      <a href="04-Design-Phase-I-Trials---Design-Considerations.html">Phase I Trials - Design Considerations</a>
    </li>
    <li>
      <a href="04-Design-Phase-II-Trials---Design-Considerations.html">Phase II Trials - Design Considerations</a>
    </li>
    <li>
      <a href="04-Design-Phase-III-Trials---Design-Considerations.html">Phase III Trials - Design Considerations</a>
    </li>
    <li>
      <a href="04-Design-Phase-IV-Trials---Design-Considerations.html">Phase IV Trials - Design Considerations for Post Marketing Surveillance</a>
    </li>
    <li>
      <a href="04-Design-Complex-Sequential-Trials.html">Complex Sequential Analysis Trials</a>
    </li>
    <li>
      <a href="04-Design-Adaptive-Clinical-Trials.html">Adaptive Clinical Trials</a>
    </li>
    <li>
      <a href="04-Design-Bayesian-Clinical-Trials.html">Bayesian Clinical Trials</a>
    </li>
    <li>
      <a href="04-Design-Dose-Escalation-and-Stratification-Designs.html">Dose Escalation and Stratification Designs in Early Oncology Development</a>
    </li>
    <li>
      <a href="04-Design-Single-Arm-Clinical-Trials.html">Single Arm Clinical Trials</a>
    </li>
    <li>
      <a href="04-Design-Diagnostic-Study-Design-and-Evaluation.html">Diagnostic Study-Design and Evaluation</a>
    </li>
    <li>
      <a href="04-Design-Diagnostic-Study-MRMC.html">Diagnostic Study-Multireader Multicase (MRMC)</a>
    </li>
    <li>
      <a href="04-Design-Vaccine-Design.html">Vaccine Trials</a>
    </li>
    <li>
      <a href="04-Design-Hierarchical-composite-endpoints.html">Hierarchical Composite Endpoints</a>
    </li>
    <li>
      <a href="04-Design-Externally-Controlled-Trials.html">Considerations for the Design and Conduct of Externally Controlled Trials</a>
    </li>
    <li>
      <a href="04-Design-Noninferiority-Trials.html">Noninferiority Trials</a>
    </li>
    <li>
      <a href="04-Design-Bioequivalence-and-Biosimilar-Trials.html">Bioequivalence and Biosimilar Trials</a>
    </li>
    <li>
      <a href="04-Design-Exploring-Survival-Analysis-Designs-for-Clinical-Trials.html">Exploring Survival Analysis Designs for Clinical Trials</a>
    </li>
    <li>
      <a href="04-Design-Projecting-How-Long-Your-Trial-Will-Take.html">Projecting How Long Your Trial Will Take</a>
    </li>
    <li>
      <a href="04-Design-Regulatory-Submission.html">Regulatory Submission from Stats Perspective</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-line-chart"></span>
     
    Data Visualization
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="05-Plot-Time-To-Event.html">Time to Event Data Visualization</a>
    </li>
    <li>
      <a href="05-Plot-PRO-Data.html">Patient Reported Outcome Data Visualization</a>
    </li>
    <li>
      <a href="05-Plot-SSC-and-Power-Calculation.html">Sample Size and Power Calculations Visualization</a>
    </li>
    <li>
      <a href="05-Plot-Correlation.html">Correlation Visualization</a>
    </li>
    <li>
      <a href="05-Plot-Model-Table.html">Clinical Data and Model visualization</a>
    </li>
    <li>
      <a href="05-Plot-ScatterPlot.html">Scatter and Line Plot</a>
    </li>
    <li>
      <a href="05-Plot-BarPlot.html">Bar Chart</a>
    </li>
    <li>
      <a href="05-Plot-PieChart.html">Pie Chart</a>
    </li>
    <li>
      <a href="05-Plot-BoxPlot.html">Box Plot</a>
    </li>
    <li>
      <a href="05-Plot-Histogram.html">Histogram</a>
    </li>
    <li>
      <a href="05-Plot-Forest-Plot.html">Forest Plot</a>
    </li>
    <li>
      <a href="05-Plot-Flow-Chart.html">Flow Chart</a>
    </li>
    <li>
      <a href="05-Plot-Some-Interesting.html">Some Interesting Plots</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-calculator"></span>
     
    Statistical Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="06-Analysis-Linear-Regression.html">Linear Regression</a>
    </li>
    <li>
      <a href="06-Analysis-Logistic-Regression.html">Logistic Regression</a>
    </li>
    <li>
      <a href="06-Analysis-Mixed-Model.html">Mixed Model</a>
    </li>
    <li>
      <a href="06-Analysis-MMRM.html">Mixed Model Repeated Measures</a>
    </li>
    <li>
      <a href="06-Analysis-GEE.html">Generalized Estimating Equation</a>
    </li>
    <li>
      <a href="06-Analysis-ANOVA.html">Analysis of Variance</a>
    </li>
    <li>
      <a href="06-Analysis-Survival-Analysis.html">Survival Analysis</a>
    </li>
    <li>
      <a href="06-Analysis-Survival-Competing-Risk.html">Survival Analysis - Competing Risk</a>
    </li>
    <li>
      <a href="06-Analysis-Missing-Data.html">Missing Data Analysis</a>
    </li>
    <li>
      <a href="06-Analysis-MI-Implementation.html">Multiple Imputation Analysis</a>
    </li>
    <li>
      <a href="06-Analysis-SSD.html">Safety Signal Detection and Evaluation</a>
    </li>
    <li>
      <a href="06-Analysis-Meta-Analysis.html">Meta Analysis</a>
    </li>
    <li>
      <a href="06-Analysis-PK-and-PD.html">PK and PD Analysis</a>
    </li>
    <li>
      <a href="06-Analysis-Time-Series-Analysis.html">Time Series Analysis</a>
    </li>
    <li>
      <a href="06-Analysis-SEM.html">Structural Equation Modeling</a>
    </li>
    <li>
      <a href="06-Analysis-Factor-Analysis.html">Factor Analysis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-bar-chart"></span>
     
    Machine Learning
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="07-ML-Bayesian-Theory.html">Bayesian Theory</a>
    </li>
    <li>
      <a href="07-ML-Bayesian-Analysis.html">Bayesian Analysis</a>
    </li>
    <li>
      <a href="07-ML-Regularization-Penalized-Regression.html">Regularization Penalized Regression</a>
    </li>
    <li>
      <a href="07-ML-Loss-Regression.html">Loss Functions in Machine Learning</a>
    </li>
    <li>
      <a href="07-ML-PCA.html">Principal Component Analysis</a>
    </li>
    <li>
      <a href="07-ML-KNN.html">K-Nearest Neighbors</a>
    </li>
    <li>
      <a href="07-ML-SVM.html">Support Vector Machine</a>
    </li>
    <li>
      <a href="07-ML-Tree-Models.html">Tree Models</a>
    </li>
    <li>
      <a href="07-ML-LDA.html">Linear Discriminant Analysis</a>
    </li>
    <li>
      <a href="07-ML-Cluster-Analysis.html">Cluster Analysis</a>
    </li>
    <li>
      <a href="07-ML-Neural-Networks.html">Neural Network</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-stethoscope"></span>
     
    Clinical Analysis (ADaM)
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="08-Clinical-Disposition-Baseline.html">Disposition and Baseline</a>
    </li>
    <li>
      <a href="08-Clinical-Efficacy-Continuous.html">Efficacy Continuous Analysis</a>
    </li>
    <li>
      <a href="08-Clinical-Efficacy-Responder.html">Efficacy Responder Analysis</a>
    </li>
    <li>
      <a href="08-Clinical-Survival-Analysis.html">Survival Analysis</a>
    </li>
    <li>
      <a href="08-Clinical-Pharmacokinetics-Analysis.html">Pharmacokinetics Analysis</a>
    </li>
    <li>
      <a href="08-Clinical-Adverse-Event.html">Adverse Event Visualization</a>
    </li>
    <li>
      <a href="08-Clinical-Laboratory-Data.html">Laboratory Data Visualization</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="08-CV.html">
    <span class="fa fa-file-pdf-o"></span>
     
    CV
  </a>
</li>
<li>
  <a href="mailto:zehuibai@outlook.com">
    <span class="fa fa-envelope-o"></span>
     
    Contact me
  </a>
</li>
<li>
  <a href="https://github.com/Zehuibai">
    <span class="fa fa-github"></span>
     
    GitHub
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore"><p><img src="logo.png"
style="width:3in" /><br />
Forest Plot and Meta Analysis</p></h1>

</div>


<div id="general-forest-plot" class="section level1">
<h1>General Forest Plot</h1>
<div id="annotated-forest-plots-alternative-1" class="section level2">
<h2>Annotated Forest Plots Alternative 1</h2>
<pre class="r"><code>## Example data frame
dat &lt;- data.frame(
  Index = c(1, 2, 3, 4), ## This provides an order to the data
  label = c(&quot;Age (65 and older versus &lt;65)&quot;, &quot;Male versus Female&quot;, &quot;High income versus Low income&quot;, &quot;High school or higher versus No High school&quot;),
  OR = c(1.00, 2.00, 3.00, 0.50),
  LL = c(0.25, 0.90, 2.25, 0.2),
  UL = c(1.75, 3.10, 3.75, 0.8),
  CI = c(&quot;0.25, 1.75&quot;, &quot;0.90, 3.10&quot;, &quot;2.25, 3.75&quot;, &quot;0.20, 0.80&quot;)
)
dat</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Index"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["label"],"name":[2],"type":["chr"],"align":["left"]},{"label":["OR"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["LL"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["UL"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["CI"],"name":[6],"type":["chr"],"align":["left"]}],"data":[{"1":"1","2":"Age (65 and older versus <65)","3":"1.0","4":"0.25","5":"1.75","6":"0.25, 1.75"},{"1":"2","2":"Male versus Female","3":"2.0","4":"0.90","5":"3.10","6":"0.90, 3.10"},{"1":"3","2":"High income versus Low income","3":"3.0","4":"2.25","5":"3.75","6":"2.25, 3.75"},{"1":"4","2":"High school or higher versus No High school","3":"0.5","4":"0.20","5":"0.80","6":"0.20, 0.80"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>plot1 &lt;- ggplot(dat, aes(y = Index, x = OR)) +
  geom_point(shape = 18, size = 5) +  
  geom_errorbarh(aes(xmin = LL, xmax = UL), height = 0.25) +
  geom_vline(xintercept = 1, color = &quot;red&quot;, linetype = &quot;dashed&quot;, cex = 1, alpha = 0.5) +
  scale_y_continuous(name = &quot;&quot;, breaks=1:4, labels = dat$label, trans = &quot;reverse&quot;) +
  xlab(&quot;Odds Ratio (95% CI)&quot;) + 
  ylab(&quot; &quot;) + 
  theme_bw() +
  theme(panel.border = element_blank(),
        panel.background = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        axis.line = element_line(colour = &quot;black&quot;),
        axis.text.y = element_text(size = 12, colour = &quot;black&quot;),
        axis.text.x.bottom = element_text(size = 12, colour = &quot;black&quot;),
        axis.title.x = element_text(size = 12, colour = &quot;black&quot;))


## Create the table-base pallete
table_base &lt;- ggplot(dat, aes(y=label)) +
  ylab(NULL) + xlab(&quot;  &quot;) + 
  theme(plot.title = element_text(hjust = 0.5, size=12), 
        axis.text.x = element_text(color=&quot;white&quot;, hjust = -3, size = 25), ## This is used to help with alignment
        axis.line = element_blank(),
        axis.text.y = element_blank(), 
        axis.ticks = element_blank(),
        axis.title.y = element_blank(), 
        legend.position = &quot;none&quot;,
        panel.background = element_blank(), 
        panel.border = element_blank(), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), 
        plot.background = element_blank())

## OR point estimate table
tab1 &lt;- table_base + 
  labs(title = &quot;space&quot;) +
  geom_text(aes(y = rev(Index), x = 1, label = sprintf(&quot;%0.1f&quot;, round(OR, digits = 1))), size = 4) + ## decimal places
  ggtitle(&quot;OR&quot;)

## 95% CI table
tab2 &lt;- table_base +
  geom_text(aes(y = rev(Index), x = 1, label = CI), size = 4) + 
  ggtitle(&quot;95% CI&quot;)

## Merge tables with plot 
grid.arrange(plot1, tab1, tab2, 
             layout_matrix = matrix(c(1,1,1,1,1,1,1,1,1,1,2,3,3), nrow = 1))</code></pre>
<p><img src="05-Plot-Forest-Plot_files/figure-html/unnamed-chunk-1-1.png" width="1152" /></p>
</div>
<div id="annotated-forest-plots-alternative-2" class="section level2">
<h2>Annotated Forest Plots Alternative 2</h2>
<pre class="r"><code># library(&quot;gt&quot;)
res_log &lt;- read_csv(&quot;https://raw.githubusercontent.com/kathoffman/steroids-trial-emulation/main/output/res_log.csv&quot;)
res &lt;- read_csv(&quot;https://raw.githubusercontent.com/kathoffman/steroids-trial-emulation/main/output/res.csv&quot;)

# res &lt;- res_log |&gt;
#       rename_with(~str_c(&quot;log.&quot;, .), estimate:conf.high) |&gt;
#   select(-p.value) |&gt;
#   full_join(res)
ForestData &lt;- res_log %&gt;%
      rename_with(~str_c(&quot;log.&quot;, .), estimate:conf.high) %&gt;%
  select(-p.value) %&gt;%
  full_join(res)
## Get a glimpse of your data
## glimpse(ForestData)
ForestData %&gt;% kbl() %&gt;%
  kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
model
</th>
<th style="text-align:right;">
log.estimate
</th>
<th style="text-align:right;">
log.conf.low
</th>
<th style="text-align:right;">
log.conf.high
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
conf.low
</th>
<th style="text-align:right;">
conf.high
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
-0.6846879
</td>
<td style="text-align:right;">
-0.8947661
</td>
<td style="text-align:right;">
-0.4746097
</td>
<td style="text-align:right;">
0.5042476
</td>
<td style="text-align:right;">
0.4087032
</td>
<td style="text-align:right;">
0.6221278
</td>
<td style="text-align:right;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
-0.0525578
</td>
<td style="text-align:right;">
-0.4201151
</td>
<td style="text-align:right;">
0.3149994
</td>
<td style="text-align:right;">
0.9487994
</td>
<td style="text-align:right;">
0.6569712
</td>
<td style="text-align:right;">
1.3702585
</td>
<td style="text-align:right;">
0.7792783
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
-0.0864096
</td>
<td style="text-align:right;">
-0.4567781
</td>
<td style="text-align:right;">
0.2839589
</td>
<td style="text-align:right;">
0.9172184
</td>
<td style="text-align:right;">
0.6333208
</td>
<td style="text-align:right;">
1.3283783
</td>
<td style="text-align:right;">
0.6474743
</td>
</tr>
<tr>
<td style="text-align:left;">
D
</td>
<td style="text-align:right;">
-0.1214702
</td>
<td style="text-align:right;">
-0.5869119
</td>
<td style="text-align:right;">
0.3439714
</td>
<td style="text-align:right;">
0.8856174
</td>
<td style="text-align:right;">
0.5560418
</td>
<td style="text-align:right;">
1.4105383
</td>
<td style="text-align:right;">
0.6089951
</td>
</tr>
<tr>
<td style="text-align:left;">
E
</td>
<td style="text-align:right;">
-0.4216403
</td>
<td style="text-align:right;">
-0.8819218
</td>
<td style="text-align:right;">
0.0386411
</td>
<td style="text-align:right;">
0.6559699
</td>
<td style="text-align:right;">
0.4139865
</td>
<td style="text-align:right;">
1.0393974
</td>
<td style="text-align:right;">
0.0725863
</td>
</tr>
<tr>
<td style="text-align:left;">
F
</td>
<td style="text-align:right;">
-0.2575052
</td>
<td style="text-align:right;">
-0.5093796
</td>
<td style="text-align:right;">
-0.0056308
</td>
<td style="text-align:right;">
0.7729776
</td>
<td style="text-align:right;">
0.6008682
</td>
<td style="text-align:right;">
0.9943850
</td>
<td style="text-align:right;">
0.0450936
</td>
</tr>
<tr>
<td style="text-align:left;">
G
</td>
<td style="text-align:right;">
0.0526079
</td>
<td style="text-align:right;">
-0.2671835
</td>
<td style="text-align:right;">
0.3723992
</td>
<td style="text-align:right;">
1.0540163
</td>
<td style="text-align:right;">
0.7655326
</td>
<td style="text-align:right;">
1.4512123
</td>
<td style="text-align:right;">
0.7471289
</td>
</tr>
<tr>
<td style="text-align:left;">
H
</td>
<td style="text-align:right;">
0.0427286
</td>
<td style="text-align:right;">
-0.2871902
</td>
<td style="text-align:right;">
0.3726475
</td>
<td style="text-align:right;">
1.0436546
</td>
<td style="text-align:right;">
0.7503690
</td>
<td style="text-align:right;">
1.4515726
</td>
<td style="text-align:right;">
0.7996192
</td>
</tr>
<tr>
<td style="text-align:left;">
I
</td>
<td style="text-align:right;">
-0.4624971
</td>
<td style="text-align:right;">
-0.7340078
</td>
<td style="text-align:right;">
-0.1909864
</td>
<td style="text-align:right;">
0.6297092
</td>
<td style="text-align:right;">
0.4799815
</td>
<td style="text-align:right;">
0.8261438
</td>
<td style="text-align:right;">
0.0008419
</td>
</tr>
<tr>
<td style="text-align:left;">
J
</td>
<td style="text-align:right;">
0.0798845
</td>
<td style="text-align:right;">
-0.2224750
</td>
<td style="text-align:right;">
0.3822440
</td>
<td style="text-align:right;">
1.0831619
</td>
<td style="text-align:right;">
0.8005350
</td>
<td style="text-align:right;">
1.4655697
</td>
<td style="text-align:right;">
0.6045771
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>## Make point and line range section of the plot
p_mid &lt;- ForestData |&gt;
  ## 1. Reverse order of factor levels
  ggplot(aes(y = fct_rev(model))) + 
  theme_classic() +
  ## 2. Show all of our information (point estimate and 95% confidence interval) on the graph
  geom_point(aes(x=log.estimate), shape=15, size=3) +
  geom_linerange(aes(xmin=log.conf.low, xmax=log.conf.high)) +
  ## 3. Add a vertical line at 0 and rename the x axis, zoom to the exact height and width
  geom_vline(xintercept = 0, linetype=&quot;dashed&quot;) +
  labs(x=&quot;Log Hazard Ratio&quot;, y=&quot;&quot;) +
  coord_cartesian(ylim=c(1,11), xlim=c(-1, .5)) +
  ## 4. Add text about protective vs. harmful using the annotate layer
  annotate(&quot;text&quot;, x = -.32, y = 11, label = &quot;Corticosteroids protective&quot;) +
  annotate(&quot;text&quot;, x = .3, y = 11, label = &quot;Corticosteroids harmful&quot;) +
  ## 5. remove everything on the y axis
  theme(axis.line.y = element_blank(),
        axis.ticks.y= element_blank(),
        axis.text.y= element_blank(),
        axis.title.y= element_blank())
p_mid</code></pre>
<p><img src="05-Plot-Forest-Plot_files/figure-html/unnamed-chunk-2-1.png" width="1152" /></p>
<pre class="r"><code>## Create estimate annotations plot
# wrangle results into pre-plotting table form
# res_plot &lt;- ForestData |&gt;
#   # round estimates and 95% CIs to 2 decimal places for journal specifications
#   mutate(across(
#     c(estimate, conf.low, conf.high),
#     ~ str_pad(
#       round(.x, 2),
#       width = 4,
#       pad = &quot;0&quot;,
#       side = &quot;right&quot;
#     )
#   ),
#   # add an &quot;-&quot; between HR estimate confidence intervals
#   estimate_lab = paste0(estimate, &quot; (&quot;, conf.low, &quot;-&quot;, conf.high, &quot;)&quot;)) |&gt;
#   # round p-values to two decimal places, except in cases where p &lt; .001
#   mutate(p.value = case_when(
#     p.value &lt; .001 ~ &quot;&lt;0.001&quot;,
#     round(p.value, 2) == .05 ~ as.character(round(p.value,3)),
#     p.value &lt; .01 ~ str_pad( # if less than .01, go one more decimal place
#       as.character(round(p.value, 3)),
#       width = 4,
#       pad = &quot;0&quot;,
#       side = &quot;right&quot;
#     ),
#     TRUE ~ str_pad( # otherwise just round to 2 decimal places and pad string so that .2 reads as 0.20
#       as.character(round(p.value, 2)),
#       width = 4,
#       pad = &quot;0&quot;,
#       side = &quot;right&quot;
#     )
#   )) |&gt;
#   # add a row of data that are actually column names which will be shown on the plot in the next step
#   bind_rows(
#     data.frame(
#       model = &quot;Model&quot;,
#       estimate_lab = &quot;Hazard Ratio (95% CI)&quot;,
#       conf.low = &quot;&quot;,
#       conf.high = &quot;&quot;,
#       p.value = &quot;p-value&quot;
#     )
#   ) |&gt;
#   mutate(model = fct_rev(fct_relevel(model, &quot;Model&quot;)))
# saveRDS(res_plot, file = &quot;res_plot.rds&quot;)
res_plot &lt;- readRDS(&quot;./01_Datasets/res_plot.rds&quot;)

res_plot %&gt;% kbl() %&gt;%
  kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
model
</th>
<th style="text-align:right;">
log.estimate
</th>
<th style="text-align:right;">
log.conf.low
</th>
<th style="text-align:right;">
log.conf.high
</th>
<th style="text-align:left;">
estimate
</th>
<th style="text-align:left;">
conf.low
</th>
<th style="text-align:left;">
conf.high
</th>
<th style="text-align:left;">
p.value
</th>
<th style="text-align:left;">
estimate_lab
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
-0.6846879
</td>
<td style="text-align:right;">
-0.8947661
</td>
<td style="text-align:right;">
-0.4746097
</td>
<td style="text-align:left;">
0.50
</td>
<td style="text-align:left;">
0.41
</td>
<td style="text-align:left;">
0.62
</td>
<td style="text-align:left;">
&lt;0.001
</td>
<td style="text-align:left;">
0.50 (0.41-0.62)
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
-0.0525578
</td>
<td style="text-align:right;">
-0.4201151
</td>
<td style="text-align:right;">
0.3149994
</td>
<td style="text-align:left;">
0.95
</td>
<td style="text-align:left;">
0.66
</td>
<td style="text-align:left;">
1.37
</td>
<td style="text-align:left;">
0.78
</td>
<td style="text-align:left;">
0.95 (0.66-1.37)
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
-0.0864096
</td>
<td style="text-align:right;">
-0.4567781
</td>
<td style="text-align:right;">
0.2839589
</td>
<td style="text-align:left;">
0.92
</td>
<td style="text-align:left;">
0.63
</td>
<td style="text-align:left;">
1.33
</td>
<td style="text-align:left;">
0.65
</td>
<td style="text-align:left;">
0.92 (0.63-1.33)
</td>
</tr>
<tr>
<td style="text-align:left;">
D
</td>
<td style="text-align:right;">
-0.1214702
</td>
<td style="text-align:right;">
-0.5869119
</td>
<td style="text-align:right;">
0.3439714
</td>
<td style="text-align:left;">
0.89
</td>
<td style="text-align:left;">
0.56
</td>
<td style="text-align:left;">
1.41
</td>
<td style="text-align:left;">
0.61
</td>
<td style="text-align:left;">
0.89 (0.56-1.41)
</td>
</tr>
<tr>
<td style="text-align:left;">
E
</td>
<td style="text-align:right;">
-0.4216403
</td>
<td style="text-align:right;">
-0.8819218
</td>
<td style="text-align:right;">
0.0386411
</td>
<td style="text-align:left;">
0.66
</td>
<td style="text-align:left;">
0.41
</td>
<td style="text-align:left;">
1.04
</td>
<td style="text-align:left;">
0.07
</td>
<td style="text-align:left;">
0.66 (0.41-1.04)
</td>
</tr>
<tr>
<td style="text-align:left;">
F
</td>
<td style="text-align:right;">
-0.2575052
</td>
<td style="text-align:right;">
-0.5093796
</td>
<td style="text-align:right;">
-0.0056308
</td>
<td style="text-align:left;">
0.77
</td>
<td style="text-align:left;">
0.60
</td>
<td style="text-align:left;">
0.99
</td>
<td style="text-align:left;">
0.045
</td>
<td style="text-align:left;">
0.77 (0.60-0.99)
</td>
</tr>
<tr>
<td style="text-align:left;">
G
</td>
<td style="text-align:right;">
0.0526079
</td>
<td style="text-align:right;">
-0.2671835
</td>
<td style="text-align:right;">
0.3723992
</td>
<td style="text-align:left;">
1.05
</td>
<td style="text-align:left;">
0.77
</td>
<td style="text-align:left;">
1.45
</td>
<td style="text-align:left;">
0.75
</td>
<td style="text-align:left;">
1.05 (0.77-1.45)
</td>
</tr>
<tr>
<td style="text-align:left;">
H
</td>
<td style="text-align:right;">
0.0427286
</td>
<td style="text-align:right;">
-0.2871902
</td>
<td style="text-align:right;">
0.3726475
</td>
<td style="text-align:left;">
1.04
</td>
<td style="text-align:left;">
0.75
</td>
<td style="text-align:left;">
1.45
</td>
<td style="text-align:left;">
0.80
</td>
<td style="text-align:left;">
1.04 (0.75-1.45)
</td>
</tr>
<tr>
<td style="text-align:left;">
I
</td>
<td style="text-align:right;">
-0.4624971
</td>
<td style="text-align:right;">
-0.7340078
</td>
<td style="text-align:right;">
-0.1909864
</td>
<td style="text-align:left;">
0.63
</td>
<td style="text-align:left;">
0.48
</td>
<td style="text-align:left;">
0.83
</td>
<td style="text-align:left;">
&lt;0.001
</td>
<td style="text-align:left;">
0.63 (0.48-0.83)
</td>
</tr>
<tr>
<td style="text-align:left;">
J
</td>
<td style="text-align:right;">
0.0798845
</td>
<td style="text-align:right;">
-0.2224750
</td>
<td style="text-align:right;">
0.3822440
</td>
<td style="text-align:left;">
1.08
</td>
<td style="text-align:left;">
0.80
</td>
<td style="text-align:left;">
1.47
</td>
<td style="text-align:left;">
0.60
</td>
<td style="text-align:left;">
1.08 (0.80-1.47)
</td>
</tr>
<tr>
<td style="text-align:left;">
Model
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
p-value
</td>
<td style="text-align:left;">
Hazard Ratio (95% CI)
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>p_left &lt;-
  res_plot  |&gt;
  ggplot(aes(y = model)) +
  geom_text(aes(x = 0, label = model), hjust = 0, fontface = &quot;bold&quot;) +
  geom_text(
    aes(x = 1, label = estimate_lab),
    hjust = 0,
    fontface = ifelse(res_plot$estimate_lab == &quot;Hazard Ratio (95% CI)&quot;, &quot;bold&quot;, &quot;plain&quot;) 
  ) +
  ## Remove the background and edit the sizing
  theme_void() +
  coord_cartesian(xlim = c(0, 4))
p_left</code></pre>
<p><img src="05-Plot-Forest-Plot_files/figure-html/unnamed-chunk-2-2.png" width="1152" /></p>
<pre class="r"><code>## Create p-value annotations
p_right &lt;-
  res_plot  |&gt;
  ggplot() +
  geom_text(
    aes(x = 0, y = model, label = p.value),
    hjust = 0,
    fontface = ifelse(res_plot$p.value == &quot;p-value&quot;, &quot;bold&quot;, &quot;plain&quot;)
  ) +
  theme_void() 
p_right</code></pre>
<p><img src="05-Plot-Forest-Plot_files/figure-html/unnamed-chunk-2-3.png" width="1152" /></p>
<pre class="r"><code>## Merge tables with plot
# library(&quot;gridExtra&quot;)
grid.arrange(p_left, p_mid, p_right, 
             layout_matrix = matrix(c(1,1,1,2,2,2,2,2,2,2,2,2,3,3), nrow = 1))</code></pre>
<p><img src="05-Plot-Forest-Plot_files/figure-html/unnamed-chunk-2-4.png" width="1152" /></p>
<pre class="r"><code>## ggsave(&quot;forest-plot.eps&quot;, width=9, height=4)</code></pre>
</div>
<div id="meta-package" class="section level2">
<h2>meta package</h2>
<pre class="r"><code>Forest.df &lt;- data.frame(study=c(&#39;S1&#39;, &#39;S2&#39;, &#39;S3&#39;, &#39;S4&#39;, &#39;S5&#39;, &#39;S6&#39;, &#39;S7&#39;),
                        index=1:7,
                        effect=c(-.4, -.25, -.1, .1, .15, .2, .3),
                        lower=c(-.43, -.29, -.17, -.02, .04, .17, .27),
                        upper=c(-.37, -.21, -.03, .22, .24, .23, .33))
## create forest plot
ggplot(data=Forest.df, 
       aes(y=index, x=effect, xmin=lower, xmax=upper,
           label=as.character(effect))) +
  geom_label(vjust=-0.1) + 
  geom_errorbarh(height=.1) +
  scale_y_continuous(breaks=1:nrow(Forest.df), labels=Forest.df$study) +
  labs(title=&#39;Effect Size by Study&#39;, 
       x=&#39;Effect Size&#39;, 
       y = &#39;Study&#39;) +
  geom_vline(xintercept=0, color=&#39;black&#39;, linetype=&#39;dashed&#39;, alpha=.5) +
  theme_classic() # theme_minimal()</code></pre>
<p><img src="05-Plot-Forest-Plot_files/figure-html/unnamed-chunk-3-1.png" width="1152" /></p>
<pre class="r"><code>## https://bookdown.org/MathiasHarrer/Doing_Meta_Analysis_in_R/forest.html
# library(&quot;meta&quot;)
data(Fleiss93)
metaresult&lt;-metabin(event.e, n.e,event.c,n.c,data=Fleiss93,sm=&quot;RR&quot;,
                    studlab=paste(study, year),random=FALSE)
forest(metaresult)</code></pre>
<p><img src="05-Plot-Forest-Plot_files/figure-html/unnamed-chunk-3-2.png" width="1152" /></p>
</div>
<div id="ggforestplot-package-based-on-se" class="section level2">
<h2>ggforestplot package (based on SE)</h2>
<p>The R package ggforestplot allows to plot vertical forest plots,
a.k.a. blobbograms, and it’s based on ggplot2, see more click (here)[<a
href="https://nightingalehealth.github.io/ggforestplot/articles/ggforestplot.html"
class="uri">https://nightingalehealth.github.io/ggforestplot/articles/ggforestplot.html</a>]</p>
<div id="basic-forestplot" class="section level3">
<h3>Basic Forestplot</h3>
<pre class="r"><code># devtools::install_github(&quot;NightingaleHealth/ggforestplot&quot;)
# library(&quot;ggforestplot&quot;)

df &lt;-
  ggforestplot::df_linear_associations %&gt;%
  filter(
    trait == &quot;BMI&quot;,
    dplyr::row_number() &lt;= 30
  )

ggforestplot::forestplot(
  df = df,
  name = name,
  estimate = beta,
  se = se,
  pvalue = pvalue,
  psignif = 0.002,
  xlab = &quot;1-SD increment in BMI\nper 1-SD increment in biomarker concentration&quot;,
  title = &quot;Associations of blood biomarkers to BMI&quot;
)</code></pre>
<p><img src="05-Plot-Forest-Plot_files/figure-html/unnamed-chunk-4-1.png" width="1152" /></p>
</div>
<div id="comparing-several-traits" class="section level3">
<h3>Comparing several traits</h3>
<pre class="r"><code># Extract the biomarker names
selected_bmrs &lt;- df %&gt;% pull(name)

# Filter the demo dataset for the biomarkers above and all three traits:
# BMI, HOMA-IR and fasting glucose
df_compare_traits &lt;-
  ggforestplot::df_linear_associations %&gt;%
  filter(name %in% selected_bmrs) %&gt;%
  # Set class to factor to set order of display.
  mutate(
    trait = factor(
      trait,
      levels = c(&quot;BMI&quot;, &quot;HOMA-IR&quot;, &quot;Fasting glucose&quot;)
    )
  )

# Draw a forestplot of cross-sectional, linear associations
# Notice how the df variable &#39;trait&#39; is used here to color the points
ggforestplot::forestplot(
  df = df_compare_traits,
  estimate = beta,
  pvalue = pvalue,
  psignif = 0.002,
  xlab = &quot;1-SD increment in cardiometabolic trait\nper 1-SD increment in biomarker concentration&quot;,
  title = &quot;Biomarker associations to metabolic traits&quot;,
  colour = trait
)</code></pre>
<p><img src="05-Plot-Forest-Plot_files/figure-html/unnamed-chunk-5-1.png" width="1152" /></p>
</div>
<div id="grouping-the-biomarkers" class="section level3">
<h3>Grouping the biomarkers</h3>
<pre class="r"><code># library(&quot;ggforce&quot;)
# Filter df_NG_biomarker_metadata, that contain the groups, for only the 30
# biomarkers under discussion
df_grouping &lt;-
  df_NG_biomarker_metadata %&gt;%
  filter(name %in% df_compare_traits$name)
# Join the association data frame df_compare_traits with group data
df_compare_traits_groups &lt;-
  df_compare_traits %&gt;%
  # use right_join, with df_grouping on the right, to preserve the order of
  # biomarkers it specifies.
  dplyr::right_join(., df_grouping, by = &quot;name&quot;) %&gt;%
  dplyr::mutate(
    group = factor(.data$group, levels = unique(.data$group))
  )

# Draw a forestplot of cross-sectional, linear associations.
forestplot(
  df = df_compare_traits_groups,
  estimate = beta,
  pvalue = pvalue,
  psignif = 0.002,
  xlab = &quot;1-SD increment in cardiometabolic trait\nper 1-SD increment in biomarker concentration&quot;,
  colour = trait
) +
  ggforce::facet_col(
    facets = ~group,
    scales = &quot;free_y&quot;,
    space = &quot;free&quot;
  )</code></pre>
<p><img src="05-Plot-Forest-Plot_files/figure-html/unnamed-chunk-6-1.png" width="1152" /></p>
</div>
</div>
<div id="ggplot2" class="section level2">
<h2>ggplot2</h2>
<pre class="r"><code>Master_Cancer_D01 &lt;- read_excel(&quot;./01_Datasets/HR_Ratio_2024.02.09.xlsx&quot;)

Breast_Cancer_Factor &lt;- c(
  &quot;3. Impact of Adjuvant Chemotherapy on Breast Cancer Survival&quot;,
  &quot;3. Breast Cancer Diagnosis to Surgery Time&quot;,
  &quot;2. Platinum Chemotherapy for Early Triple-Negative Breast Cancer&quot;,
  &quot;2. Breast Cancer Diagnosis to Surgery Time&quot;,
  &quot;1. Trastuzumab Regimen in HER2+ Early-Stage Breast Cancer: Meta-Analysis&quot;,
  &quot;1. Breast Cancer Diagnosis to Surgery Time&quot;
  )
 
Breast_Cancer_Label&lt;- c(
  &quot; Impact of Adjuvant Chemotherapy on Breast Cancer Survival&quot;,
  &quot; Breast Cancer Diagnosis to Surgery Time&quot;,
  &quot;  Platinum Chemotherapy for Early Triple-Negative Breast Cancer&quot;,
  &quot;  Breast Cancer Diagnosis to Surgery Time&quot;,
  &quot;   Trastuzumab Regimen in HER2+ Early-Stage Breast Cancer: Meta-Analysis&quot;,
  &quot;   Breast Cancer Diagnosis to Surgery Time&quot;
  ) 
 
Breast_Cancer_Label &lt;- paste0(Breast_Cancer_Label,
                              &quot;\n&quot;,
                              rev(Master_Cancer_D01[which(Master_Cancer_D01$CancerType == &quot;Breast Cancer&quot;),]$Cite))

Breast_Cancer_Data &lt;- Master_Cancer_D01 %&gt;%
  filter(CancerType == &quot;Breast Cancer&quot;) %&gt;%
  mutate(Category = factor(Category, levels = Breast_Cancer_Factor, labels=Breast_Cancer_Label))
  
Breast_Cancer_Plot &lt;- 
  Breast_Cancer_Data %&gt;%
  ggplot(aes(x = Estimate, y = Category)) + 
  scale_x_continuous(trans = &quot;log10&quot;, 
                breaks = c(0.6, 0.8, 1.0, 1.2, 1.5),
                limits = c(0.5, 1.5)) + 
  theme_forest() + 
  scale_colour_ng_d() + 
  scale_fill_ng_d() + 
  geom_stripes() + 
  geom_vline(xintercept = 1, linetype = &quot;dashed&quot;, size = 0.5, colour = &quot;black&quot;) + 
  geom_hline(yintercept = 4.5, linetype = &quot;solid&quot;, size = 1.2, colour = &quot;black&quot;) + 
  geom_hline(yintercept = 2.5, linetype = &quot;solid&quot;, size = 1.2, colour = &quot;black&quot;) + 
  geom_effect(ggplot2::aes(xmin = conf.low, xmax = conf.high), 
        position = ggstance::position_dodgev(height = 0.5)) + 
        ggplot2::scale_shape_manual(values = c(21L, 22L, 23L, 
            24L, 25L)) + guides(colour = guide_legend(reverse = TRUE), 
        shape = guide_legend(reverse = TRUE)) +
  annotate(&quot;text&quot;, x = 0.65, y = Inf, label = &quot;Relative Improvement in\nOverall Survival From Treatment&quot;, 
           hjust = 0, vjust = 1, colour = &quot;black&quot;,size = 5) +
  annotate(&quot;text&quot;, x = 1.08, y = Inf, label = &quot;Relative Decrease in\nOverall Survival From Delay&quot;, 
           hjust = 0, vjust = 1, colour = &quot;black&quot;,size = 5) +
  geom_textbox(aes(label = paste0(format(Estimate, digits = 3),
                             &quot; [&quot;,
                             format(conf.low, digits = 3),&quot;,&quot;,
                             format(conf.high, digits = 3),
                             &quot;]&quot;), 
              x = Estimate), hjust = 0.5, vjust = 1.3, width = 0.132)+ 
  labs(title = &quot;Figure 1: Breast Cancer&quot;) +
  labs(subtitle = &quot;&quot;) +
  labs(x = &quot;Hazard Ratio&quot;) +
  labs(y = &quot;&quot;) +
  theme(text = element_text(size = 16)) 

png(&#39;./02_Plots/Visualization/ForestPlot/HR_Breast_Cancer.png&#39;,width=16, height=8,unit=&quot;in&quot;, res=600)
Breast_Cancer_Plot
dev.off()</code></pre>
<pre><code>## cairo_pdf 
##         2</code></pre>
<pre class="r"><code>knitr::include_graphics(&quot;./02_Plots/Visualization/ForestPlot/HR_Breast_Cancer.png&quot;)</code></pre>
<p><img src="02_Plots/Visualization/ForestPlot/HR_Breast_Cancer.png" width="4800" /></p>
</div>
</div>
<div id="alternative-to-forest-plot-dlqi-data" class="section level1">
<h1>Alternative to Forest Plot DLQI Data</h1>
<div id="errorbar" class="section level2">
<h2>Errorbar</h2>
<p><img src="02_Plots/Visualization/ForestPlot/DLQI_1.png" /></p>
<p><strong>Source: Figure 2 in Muntyanu A, Gabrielli S, Donovan J,
Gooderham M, Guenther L, Hanna S, et al. The burden of alopecia areata:
A scoping review focusing on quality of life, mental health and work
productivity. J Eur Acad Dermatol Venereol. 2023; 37: 1490–1520. <a
href="https://doi.org/10.1111/jdv.18926"
class="uri">https://doi.org/10.1111/jdv.18926</a></strong></p>
<pre class="r"><code># Example data frame
data &lt;- data.frame(
  Study_Number = 1:12,
  Mean_DLQI = c(4.8, 3.5, 2.1, 10.69, 6.1, 7.9, 7.7, 8.1636, 7.21, 5.8, 6.8, 6.4),
  Lower_CI = c(2, 1, 1, 9, 4, 6, 5, 7, 6, 4, 5, 5),  # Example lower CI values
  Upper_CI = c(8, 6, 4, 12, 8, 10, 10, 10, 9, 8, 9, 8)  # Example upper CI values
)
 

ggplot(data, aes(x = factor(Study_Number), y = Mean_DLQI)) +
  geom_col(fill = &quot;salmon&quot;, width = 0.7) +  # Bars with salmon fill
  geom_errorbar(aes(ymin = Lower_CI, ymax = Upper_CI), width = 0.2, color = &quot;black&quot;) +  # Error bars
  geom_label(aes(label = round(Mean_DLQI, 2)), vjust = -1.5, fill = &quot;white&quot;, color = &quot;black&quot;, 
             fontface = &quot;bold&quot;, label.size = 0.5) +  # Label with white background
  labs(
    title = &quot;DLQI in Alopecia Areata Studies&quot;,
    x = &quot;Study Number&quot;,
    y = &quot;DLQI Score&quot;
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),  # Centering the title
    axis.title.x = element_text(face = &quot;bold&quot;),
    axis.title.y = element_text(face = &quot;bold&quot;),
    axis.text.x = element_text(angle = 90, hjust = 1)  # Angle x axis text for readability
  )</code></pre>
<p><img src="05-Plot-Forest-Plot_files/figure-html/unnamed-chunk-8-1.png" width="1152" /></p>
</div>
<div id="mean-dlqi" class="section level2">
<h2>Mean DLQI</h2>
<p>This is a simple, but clean visualisation with logical ordering of
studies based on mean DLQI score. As per some of the other submissions,
the axes have been flipped here compared to the original, published
visualisation. This allows for the author name and sample size to be
displayed on the label, as well as sample size. However, sample size
could more effectively be encoded within the plot itself, to save the
reader from having to study the axis labels at length. There is a
telling title added with colours nicely included to link the title to
the plot itself. Additional information is deferred to a footnote, and
here shading is used to display the meaningful DLQI categories (again,
these categories are for DLQI scores at a total level). These categories
motivate a panel discussion on how useful it is to display these
categories, corresponding to individual patients, for a presentation of
the mean. The issue here is that, due to DLQI only taking integer scores
for each patient, the meaningful categories have gaps between their
extremes. The author has chosen to leave these as blank space in the
plot, which could be confusing for a reader who is not familiar with
DLQI scores or the categories. An alternative would be to use the
midpoints (1.5 and 5.5 for the displayed categories) as the values to
change the shading at. This submission also lead to a nice discussion on
minimising white space, while avoiding confusion. The user only takes
the x-axis as far as a score of 10, which captures all the observed
data, while presenting it in the maximum amount of space to allow
comparison between the categories. However, it could mislead the reader
that several studies have a mean DLQI score close to the upper limit of
those which can be taken by the tool (which is not the case, DLQI scores
can be as high as 30). Taking the x-axis as far as 30 here would give an
easier interpretation of the overall experience of patients with
alopecia areata, compared with what is possible.</p>
<p><img src="02_Plots/Visualization/ForestPlot/DLQI_2.png" /></p>
<p><img src="02_Plots/Visualization/ForestPlot/DLQI_2b.png" /></p>
<pre class="r"><code># Sample data
data &lt;- data.frame(
  Study = c(&quot;Abedini et al.&quot;, &quot;Liu et al.&quot;, &quot;Shi et al.&quot;, &quot;Ghajarzadeh et al.&quot;,
            &quot;Velez-Muniz et al.&quot;, &quot;Qi et al.&quot;, &quot;Ito et al.&quot;, &quot;Ferentinos et al.&quot;, &quot;Andersen et al.&quot;),
  N = c(176, 383, 532, 100, 126, 698, 400, 52, 1494),
  Mean_DLQI = c(1.5, 2.5, 3.0, 4.0, 5.5, 4.5, 6.0, 6.5, 7.0),
  Lower_CI = c(0.5, 1.5, 2.5, 3.5, 4.0, 3.5, 5.5, 6.0, 6.0),
  Upper_CI = c(2.5, 3.5, 3.5, 4.5, 7.0, 5.5, 6.5, 8.0, 10.0)
)

data &lt;- data %&gt;%
  arrange(Mean_DLQI) %&gt;%
  mutate(Study = factor(Study, levels = Study))

# Determine the number of studies to set the y position for annotations
num_studies &lt;- nrow(data)

ggplot(data, aes(y = Study, x = Mean_DLQI, xmin = Lower_CI, xmax = Upper_CI)) +
  geom_rect(aes(xmin = 0, xmax = 1, ymin = -Inf, ymax = Inf), fill = &quot;#FFD885&quot;, alpha = 0.2) +  # None
  geom_rect(aes(xmin = 2, xmax = 5, ymin = -Inf, ymax = Inf), fill = &quot;#E4D383&quot;, alpha = 0.2) +  # Small
  geom_rect(aes(xmin = 6, xmax = 10, ymin = -Inf, ymax = Inf), fill = &quot;#9BBC93&quot;, alpha = 0.2) +  # Moderate
  geom_pointrange(size = 0.5, color = &quot;black&quot;) +
  annotate(&quot;text&quot;, x = 1, y = num_studies + 0.5, label = &quot;None&quot;, vjust = 0) +
  annotate(&quot;text&quot;, x = 3.5, y = num_studies + 0.5, label = &quot;Small&quot;, vjust = 0) +
  annotate(&quot;text&quot;, x = 7.5, y = num_studies + 0.5, label = &quot;Medium&quot;, vjust = 0) +
  scale_y_discrete(limits = c(levels(data$Study), &quot; &quot;), expand = c(0, 0.1)) +  # Extend y-axis
  scale_x_continuous(&quot;Mean DLQI Score&quot;, breaks = 0:10) +
  labs(y = &quot;Study&quot;, title = &quot;Across Studies, alopecia areata had on average a small or moderate impact on patients&#39; lives&quot;) +
  theme_minimal() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())</code></pre>
<p><img src="05-Plot-Forest-Plot_files/figure-html/unnamed-chunk-9-1.png" width="1152" /></p>
<pre class="r"><code># Clear environment and read in libraries
rm(list = ls()) 

# Simulate 4 studies with different treatments/sample sizes
subjects &lt;- as.character(seq(1, 850))

trts &lt;- c(sample(c(&#39;Placebo&#39;, &#39;A&#39;, &#39;B&#39;),
                 size = 300, replace = T),
          sample(c(&#39;Placebo&#39;, &#39;C&#39;),
                 size = 100, replace = T),
          sample(c(&#39;B&#39;, &#39;C&#39;),
                 size = 300, replace = T),
          sample(c(&#39;B&#39;, &#39;D&#39;),
                 size = 150, replace = T))

studies &lt;- c(rep(&#39;Study 1&#39;, 300),
             rep(&#39;Study 2&#39;, 100),
             rep(&#39;Study 3&#39;, 300),
             rep(&#39;Study 4&#39;, 150))

visits &lt;- c(rep(seq(0, 100, length.out = 10), each = 300),
            rep(seq(0, 75,  length.out  = 8), each = 100),
            rep(seq(0, 100, length.out = 10), each = 300),
            rep(seq(0, 50,  length.out = 6),  each = 150))

# Random study effects
study_effs &lt;- c(rep(rnorm(1, sd = 3), 300),
                rep(rnorm(1, sd = 3), 100),
                rep(rnorm(1, sd = 3), 300),
                rep(rnorm(1, sd = 3), 150))

# Random subject effects
sub_effs &lt;- rnorm(850, 0, 3)

# Repeat values for each visit e.g. in study 1, each subject needs 10 records
split &lt;- function(vec){
  return(
    c(rep(vec[1:300], 10),
      rep(vec[301:400], 8),
      rep(vec[401:700], 10),
      rep(vec[701:850], 6)))
}

# Create study dataframe
df &lt;- data.frame(subject   = split(subjects),
                 study     = split(studies),
                 trt       = split(trts),
                 study_eff = split(study_effs),
                 sub_eff   = split(sub_effs),
                 time      = as.character(round(visits, 0)))

# Find each subject/treatment combo - will need to merge this on later
subject_df &lt;- df %&gt;%
              select(subject, trt) %&gt;%
              mutate(trt = if_else(trt != &#39;Placebo&#39;,
                                   paste0(&#39;Treatment &#39;, trt),
                                   trt)) %&gt;%
              unique()

# Coefficients for treatment variables
beta0 &lt;- 15
betaA &lt;- 0.2
betaB &lt;- -0.1
betaC &lt;- 0.1
betaD &lt;- 0.05

# Coefficients for interaction variables
gamma &lt;- 0.01
gammaA &lt;- 0.025
gammaB &lt;- -0.1
gammaC &lt;- 0.0001
gammaD &lt;- -0.05


# Find DLQI score for each 
dlqi_calc &lt;- function(n, A, B, C, D, time, study_eff, sub_eff){
  
  dlqi &lt;- beta0 + betaA*A + betaB*B +
          betaC*C + betaD*D + 
          gamma*time + gammaA*A*time + gammaB*B*time +
          gammaC*C*time + gammaD*D*time +
          sub_eff + study_eff
  
  return(rnorm(n, dlqi, 3))
}


dlqi_df &lt;- df %&gt;%
  
           # Create variables needed for dlqi_calc
           pivot_wider(id_cols = c(subject, study, study_eff, sub_eff, time),
                       names_from = trt,
                       values_from = trt,
                       values_fn = length,
                       values_fill = 0) %&gt;%
           mutate(time = as.numeric(time),
                  dlqi = dlqi_calc(n(), A, B, C, D, time, study_eff, sub_eff),
                  
                  # Apply cut-off thresholds
                  dlqi = case_when(
                                   dlqi &lt; 0 ~ 0,
                                   dlqi &gt; 30 ~ 30,
                                   T ~ dlqi)) %&gt;%
           left_join(subject_df, by = &#39;subject&#39;) %&gt;%
           group_by(trt, study, time) %&gt;%
           mutate(mean = mean(dlqi),
                  
                  # Add some jitter so plot points are not over-layed
                  time = case_when(study == &#39;Study 1&#39; &amp; trt == &#39;Placebo&#39; ~ time - 2,
                          study == &#39;Study 1&#39; &amp; trt == &#39;Treatment B&#39; ~ time + 2,
                          study == &#39;Study 2&#39; &amp; trt == &#39;Placebo&#39; ~ time - 1,
                          study == &#39;Study 2&#39; &amp; trt == &#39;Treatment C&#39; ~ time + 1,
                          study == &#39;Study 3&#39; &amp; trt == &#39;Treatment B&#39; ~ time - 1,
                          study == &#39;Study 3&#39; &amp; trt == &#39;Treatment C&#39; ~ time + 1,
                          study == &#39;Study 4&#39; &amp; trt == &#39;Treatment D&#39; ~ time + 1,
                          study == &#39;Study 4&#39; &amp; trt == &#39;Treatment B&#39; ~ time - 1,
                          T ~ time))
  
# Color the subscript treatment labels
color_label &lt;- function(color, trt){
    paste0(&quot;N&quot;,
    &quot;&lt;sub&gt;&lt;span style = &#39;color:&quot;, color, &quot;;&#39;&gt;&quot;, trt, &quot;&lt;/span&gt;&lt;/sub&gt;&lt;/span&gt;&quot;)
}

nP &lt;- color_label(hue_pal()(5)[1], &#39;P&#39;)
nA &lt;- color_label(hue_pal()(5)[2], &#39;A&#39;)
nB &lt;- color_label(hue_pal()(5)[3], &#39;B&#39;)
nC &lt;- color_label(hue_pal()(5)[4], &#39;C&#39;)
nD &lt;- color_label(hue_pal()(5)[5], &#39;D&#39;)

# Create the desired facet labels
study.labs &lt;- c(paste0(&#39;Study 1 &lt;br&gt;&lt;br&gt;&#39;,
                       nP, &#39; = &#39;, nA, &#39; = &#39;, nB, &#39; = 100&#39;),
                paste0(&#39;Study 2 &lt;br&gt;&lt;br&gt;&#39; ,
                       nP, &#39; = &#39;, nC, &#39; = &#39;, &#39;50&#39;),
                paste0(&#39;Study 3 &lt;br&gt;&lt;br&gt;&#39;,
                       nB, &#39; = &#39;, nC, &#39; = &#39;, &#39;100&#39;),
                paste0(&#39;Study 4 &lt;br&gt;&lt;br&gt;&#39;,
                       nB, &#39; = &#39;, nD, &#39; = &#39;, &#39;75&#39;))

names(study.labs) &lt;- c(&#39;Study 1&#39;, &#39;Study 2&#39;, &#39;Study 3&#39;, &#39;Study 4&#39;)

# Create the plot
png(&quot;./02_Plots/Visualization/ForestPlot/DLQI_5.png&quot;, res = 500, height = 5, width = 7, units = &#39;in&#39;)

ggplot(data = dlqi_df) +
  
  geom_point(aes(x = time,
                 y = dlqi,
                 color = trt), alpha = 0.1, size = 0.3) +
  
  facet_wrap(~study, ncol = 1, strip.position = &#39;right&#39;,
             labeller = labeller(study = study.labs)) +
  
  geom_line(aes(x = time,
                y = mean,
                group = trt,
                color = trt),
            size = 0.5, alpha = 0.75) +
  
  theme(panel.background       = element_rect(fill = &#39;gray10&#39;),
        panel.border           = element_rect(color = &#39;gray20&#39;, 
                                              size  = unit(1, &#39;in&#39;), 
                                              fill  = NA),
        plot.margin            = margin(20, 20, 20, 20),
        panel.grid.minor       = element_blank(),
        plot.background        = element_rect(fill  = &#39;gray10&#39;, 
                                              color = &#39;gray10&#39;),
        panel.grid.major       = element_line(color =&#39;gray13&#39;),

        legend.position        = c(0.43, 1.17),
        legend.justification   = &#39;top&#39;,
        legend.background      = element_rect(fill = &#39;gray10&#39;),
        legend.title           = element_blank(),
        legend.key             = element_rect(fill = &#39;gray10&#39;),
        legend.text.align      = 0,
        legend.text            = element_text(color = &#39;gray90&#39;,
                                              size = 8),
        
        strip.background       = element_rect(fill = &#39;gray20&#39;),
        panel.spacing          = unit(0.15, &#39;in&#39;),
        strip.text.y           = element_markdown(angle = 0, 
                                                  color = &#39;white&#39;,
                                                  face  = &#39;bold&#39;, 
                                                  size  = 8),

        axis.text             = element_text(color = &#39;gray70&#39;),
        axis.title.x          = element_text(hjust  = 0, 
                                             color  = &#39;white&#39;,
                                             face   = &#39;bold&#39;,
                                             margin = margin(t = 12.5),
                                             size   = 8),
        plot.title            = element_text(color = &#39;white&#39;, 
                                             hjust = 0,
                                             face = &#39;bold&#39;,
                                             margin = margin(b = 7),
                                             size = 12),
        plot.subtitle         = element_text(color = &#39;gray90&#39;, 
                                             face = &#39;italic&#39;,
                                             size = 7, 
                                            margin = margin(b = 32)),
        plot.title.position   = &#39;plot&#39;,
        plot.caption.position = &#39;plot&#39;,
        plot.caption          = element_text(size = 7, 
                                             color = &#39;white&#39;, 
                                             face = &#39;bold.italic&#39;)) +
  
  
  coord_cartesian(ylim = c(0, 30), clip = &#39;off&#39;) +
  
  guides(color = guide_legend(nrow = 1)) +
  
  labs(x        = &#39;Relative Day&#39;,
       y        = NULL,
       title    = &#39;Mean DLQI Score over Time for Four Different Studies&#39;,
       caption  = &#39;Huw Wilson&#39;,
       subtitle = &#39;Lower DLQI scores indicate less severe symptoms.&#39;)

dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<p><img src="02_Plots/Visualization/ForestPlot/DLQI_5.png" /></p>
</div>
<div id="informative-panel" class="section level2">
<h2>Informative Panel</h2>
<p>This is an informative submission which can be broken down into its
different panels. These panels are supplemented by additional links and
informative subheadings to aid understanding. The user is first
presented with some general information about the studies (demographics,
as well as sample size). The cells presenting sample size are shaded in
accordance with the sample size, and these sample sizes are used to
provide a logical ordering of the studies. The choice of the intense
shade for the largest sample size immediately draws our attention to
that study. The next panel then displays small 5-number summaries for
the total DLQI in each study (presenting mean, medians, quartiles and
SD). One panellist did pick out that the choice of display for the
median and quartiles could confuse a reader who does not take care to
read the legend, as they could interpret the display as a boxplot (which
would have the quartiles displayed differently). A shaded is applied
within this column, which is intuitive with ‘clearance’ of issues and
the intense, dark red shade depicting the largest (negative) impact. It
could be argued that the select shades should be based on the DLQI score
range of 0 to 30, as opposed to the observed means for the selected
studies (could mislead that the highest mean of 10.7, here, is towards
the upper extreme of possible DLQI scores). The final panel presents
density dot plots for simulated patient level data. While the individual
points are a little small to make out (meaning we don’t see a lot for
some of the smaller studies), this nicely highlights how summary stats
may not capture the experience of many patients, per other submissions
which have presented simulated patient level data. The mean is added as
a reference line to aid interpretation, and the x-axis presents the full
range of 0 to 30 here, indicating that across studies, the bulk of
patients have DLQI scores towards the lower end of the DLQI range
(mitigating against misunderstanding which could have been caused by the
shading in the previous panel, as well as driving home just how
different some of the sample sizes are)</p>
<p><img src="02_Plots/Visualization/ForestPlot/DLQI_3.png" /></p>
<p><img src="02_Plots/Visualization/ForestPlot/DLQI_3b.png" /></p>
</div>
<div id="individual-study-dlqi" class="section level2">
<h2>Individual Study DLQI</h2>
<p>The visualisation had simulated the DLQI scores of individual
patients, to provide mean and standard deviations equal to those
published for each of the studies. These individual data points are then
plotted for each of the studies, with the corresponding densities
displayed. This nicely highlights, in this case, how a simple
presentation of mean and standard deviation may not capture the
experience of many of the individual patients within the studies. The
mean for each study is still displayed as a diamond, and has its size
set proportional to the sample size for the respective study. Such a
display is effectively used in some of the other submissions from this
webinar, but here does sometimes cause the mean to be somewhat difficult
to spot, particularly for small studies with a mean value close to an
integer score (where it overlaps with individual data points – see for
instance, study 11). Reference lines are added to display the meaningful
score categories which exist for DLQI total score at a patient level.
These in turn dictate the colours used for each study, with a telling
title added to provide an interpretation of the overall patient
experience. A more convincing message could have been delivered by
applying a logical sorting based on e.g. mean score, rather than study
number.</p>
<p><img src="02_Plots/Visualization/ForestPlot/DLQI_4.png" /></p>
</div>
<div id="double-dot-plot" class="section level2">
<h2>Double Dot Plot</h2>
<p><img src="02_Plots/Visualization/ForestPlot/DoubleDot.png" /></p>
</div>
<div id="lollipopforest-plot" class="section level2">
<h2>Lollipop/forest plot</h2>
<pre class="r"><code># library(RCurl) 
# library(ggrepel)
# library(cowplot)
# library(ggtext)

y &lt;- read.csv(&quot;./01_Datasets/CGI_S_3_groups_csv.csv&quot;) %&gt;%
   rename(Group = CGI)

l &lt;- y %&gt;%
  pivot_longer(cols = X1:X7,
               names_to = &quot;Category&quot;,
               values_to = &quot;n&quot;) %&gt;%
  mutate(Category = as.numeric(gsub(&quot;X&quot;, &quot;&quot;, Category))) %&gt;%
  group_by(Week, Group) %&gt;%
  arrange(Category) %&gt;%
  mutate(
    CumN = cumsum(n),
    Week = paste(&quot;Week&quot;, Week),
    CumFreq = CumN / Total.sample.size,
    Freq = n / Total.sample.size,
    `Cumulative %` = round(CumFreq * 100, 1),
    `%` = round(Freq * 100, 1)
  ) %&gt;%
  ungroup() %&gt;%
  group_by(Week, Category) %&gt;%
  arrange(Group, .by_group = T) %&gt;%
  mutate(
    Odds = CumFreq / (1 - CumFreq),
    OR = ifelse(Group == &quot;Active&quot;, round(Odds / Odds[2], 2), NA),
    selogOR = ifelse(Group == &quot;Active&quot;, sqrt(
      1 / CumN + 1 / (Total.sample.size - CumN) + 1 / CumN[2] + 1 / (Total.sample.size[2] -
                                                                       CumN[2])
    ), NA),
    ORlower95CI = ifelse(Group == &quot;Active&quot;, round(exp(log(OR) - 1.96 * selogOR), 2), NA),
    ORupper95CI = ifelse(Group == &quot;Active&quot;, round(exp(log(OR) + 1.96 * selogOR), 2), NA)
  )
l</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Week"],"name":[1],"type":["chr"],"align":["left"]},{"label":["Group"],"name":[2],"type":["chr"],"align":["left"]},{"label":["Total.sample.size"],"name":[3],"type":["int"],"align":["right"]},{"label":["Category"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["n"],"name":[5],"type":["int"],"align":["right"]},{"label":["CumN"],"name":[6],"type":["int"],"align":["right"]},{"label":["CumFreq"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["Freq"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["Cumulative %"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["%"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["Odds"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["OR"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["selogOR"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["ORlower95CI"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["ORupper95CI"],"name":[15],"type":["dbl"],"align":["right"]}],"data":[{"1":"Week 12","2":"Active","3":"108","4":"1","5":"18","6":"18","7":"0.16666667","8":"0.166666667","9":"16.7","10":"16.7","11":"0.20000000","12":"1.98","13":"0.4204375","14":"0.87","15":"4.51"},{"1":"Week 12","2":"Comparator","3":"109","4":"1","5":"10","6":"10","7":"0.09174312","8":"0.091743119","9":"9.2","10":"9.2","11":"0.10101010","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 12","2":"Placebo","3":"108","4":"1","5":"2","6":"2","7":"0.01851852","8":"0.018518519","9":"1.9","10":"1.9","11":"0.01886792","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 12","2":"Active","3":"108","4":"2","5":"32","6":"50","7":"0.46296296","8":"0.296296296","9":"46.3","10":"29.6","11":"0.86206897","12":"1.49","13":"0.2770093","14":"0.87","15":"2.56"},{"1":"Week 12","2":"Comparator","3":"109","4":"2","5":"30","6":"40","7":"0.36697248","8":"0.275229358","9":"36.7","10":"27.5","11":"0.57971014","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 12","2":"Placebo","3":"108","4":"2","5":"5","6":"7","7":"0.06481481","8":"0.046296296","9":"6.5","10":"4.6","11":"0.06930693","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 12","2":"Active","3":"108","4":"3","5":"44","6":"94","7":"0.87037037","8":"0.407407407","9":"87.0","10":"40.7","11":"6.71428571","12":"0.68","13":"0.4383696","14":"0.29","15":"1.61"},{"1":"Week 12","2":"Comparator","3":"109","4":"3","5":"59","6":"99","7":"0.90825688","8":"0.541284404","9":"90.8","10":"54.1","11":"9.90000000","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 12","2":"Placebo","3":"108","4":"3","5":"30","6":"37","7":"0.34259259","8":"0.277777778","9":"34.3","10":"27.8","11":"0.52112676","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 12","2":"Active","3":"108","4":"4","5":"10","6":"104","7":"0.96296296","8":"0.092592593","9":"96.3","10":"9.3","11":"26.00000000","12":"0.49","13":"0.8769043","14":"0.09","15":"2.73"},{"1":"Week 12","2":"Comparator","3":"109","4":"4","5":"8","6":"107","7":"0.98165138","8":"0.073394495","9":"98.2","10":"7.3","11":"53.50000000","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 12","2":"Placebo","3":"108","4":"4","5":"50","6":"87","7":"0.80555556","8":"0.462962963","9":"80.6","10":"46.3","11":"4.14285714","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 12","2":"Active","3":"108","4":"5","5":"3","6":"107","7":"0.99074074","8":"0.027777778","9":"99.1","10":"2.8","11":"107.00000000","12":"0.00","13":"Inf","14":"0.00","15":"NaN"},{"1":"Week 12","2":"Comparator","3":"109","4":"5","5":"2","6":"109","7":"1.00000000","8":"0.018348624","9":"100.0","10":"1.8","11":"Inf","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 12","2":"Placebo","3":"108","4":"5","5":"15","6":"102","7":"0.94444444","8":"0.138888889","9":"94.4","10":"13.9","11":"17.00000000","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 12","2":"Active","3":"108","4":"6","5":"1","6":"108","7":"1.00000000","8":"0.009259259","9":"100.0","10":"0.9","11":"Inf","12":"NaN","13":"Inf","14":"NaN","15":"NaN"},{"1":"Week 12","2":"Comparator","3":"109","4":"6","5":"0","6":"109","7":"1.00000000","8":"0.000000000","9":"100.0","10":"0.0","11":"Inf","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 12","2":"Placebo","3":"108","4":"6","5":"4","6":"106","7":"0.98148148","8":"0.037037037","9":"98.1","10":"3.7","11":"53.00000000","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 12","2":"Active","3":"108","4":"7","5":"0","6":"108","7":"1.00000000","8":"0.000000000","9":"100.0","10":"0.0","11":"Inf","12":"NaN","13":"Inf","14":"NaN","15":"NaN"},{"1":"Week 12","2":"Comparator","3":"109","4":"7","5":"0","6":"109","7":"1.00000000","8":"0.000000000","9":"100.0","10":"0.0","11":"Inf","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 12","2":"Placebo","3":"108","4":"7","5":"2","6":"108","7":"1.00000000","8":"0.018518519","9":"100.0","10":"1.9","11":"Inf","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 52","2":"Active","3":"108","4":"1","5":"35","6":"35","7":"0.32407407","8":"0.324074074","9":"32.4","10":"32.4","11":"0.47945205","12":"3.00","13":"0.3457962","14":"1.52","15":"5.91"},{"1":"Week 52","2":"Comparator","3":"109","4":"1","5":"15","6":"15","7":"0.13761468","8":"0.137614679","9":"13.8","10":"13.8","11":"0.15957447","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 52","2":"Placebo","3":"108","4":"1","5":"5","6":"5","7":"0.04629630","8":"0.046296296","9":"4.6","10":"4.6","11":"0.04854369","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 52","2":"Active","3":"108","4":"2","5":"29","6":"64","7":"0.59259259","8":"0.268518519","9":"59.3","10":"26.9","11":"1.45454545","12":"1.85","13":"0.2749164","14":"1.08","15":"3.17"},{"1":"Week 52","2":"Comparator","3":"109","4":"2","5":"33","6":"48","7":"0.44036697","8":"0.302752294","9":"44.0","10":"30.3","11":"0.78688525","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 52","2":"Placebo","3":"108","4":"2","5":"9","6":"14","7":"0.12962963","8":"0.083333333","9":"13.0","10":"8.3","11":"0.14893617","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 52","2":"Active","3":"108","4":"3","5":"35","6":"99","7":"0.91666667","8":"0.324074074","9":"91.7","10":"32.4","11":"11.00000000","12":"1.23","13":"0.4715138","14":"0.49","15":"3.10"},{"1":"Week 52","2":"Comparator","3":"109","4":"3","5":"50","6":"98","7":"0.89908257","8":"0.458715596","9":"89.9","10":"45.9","11":"8.90909091","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 52","2":"Placebo","3":"108","4":"3","5":"30","6":"44","7":"0.40740741","8":"0.277777778","9":"40.7","10":"27.8","11":"0.68750000","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 52","2":"Active","3":"108","4":"4","5":"5","6":"104","7":"0.96296296","8":"0.046296296","9":"96.3","10":"4.6","11":"26.00000000","12":"0.49","13":"0.8769043","14":"0.09","15":"2.73"},{"1":"Week 52","2":"Comparator","3":"109","4":"4","5":"9","6":"107","7":"0.98165138","8":"0.082568807","9":"98.2","10":"8.3","11":"53.50000000","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 52","2":"Placebo","3":"108","4":"4","5":"45","6":"89","7":"0.82407407","8":"0.416666667","9":"82.4","10":"41.7","11":"4.68421053","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 52","2":"Active","3":"108","4":"5","5":"3","6":"107","7":"0.99074074","8":"0.027777778","9":"99.1","10":"2.8","11":"107.00000000","12":"0.99","13":"1.4207762","14":"0.06","15":"16.03"},{"1":"Week 52","2":"Comparator","3":"109","4":"5","5":"1","6":"108","7":"0.99082569","8":"0.009174312","9":"99.1","10":"0.9","11":"108.00000000","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 52","2":"Placebo","3":"108","4":"5","5":"10","6":"99","7":"0.91666667","8":"0.092592593","9":"91.7","10":"9.3","11":"11.00000000","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 52","2":"Active","3":"108","4":"6","5":"1","6":"108","7":"1.00000000","8":"0.009259259","9":"100.0","10":"0.9","11":"Inf","12":"NaN","13":"Inf","14":"NaN","15":"NaN"},{"1":"Week 52","2":"Comparator","3":"109","4":"6","5":"1","6":"109","7":"1.00000000","8":"0.009174312","9":"100.0","10":"0.9","11":"Inf","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 52","2":"Placebo","3":"108","4":"6","5":"4","6":"103","7":"0.95370370","8":"0.037037037","9":"95.4","10":"3.7","11":"20.60000000","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 52","2":"Active","3":"108","4":"7","5":"0","6":"108","7":"1.00000000","8":"0.000000000","9":"100.0","10":"0.0","11":"Inf","12":"NaN","13":"Inf","14":"NaN","15":"NaN"},{"1":"Week 52","2":"Comparator","3":"109","4":"7","5":"0","6":"109","7":"1.00000000","8":"0.000000000","9":"100.0","10":"0.0","11":"Inf","12":"NA","13":"NA","14":"NA","15":"NA"},{"1":"Week 52","2":"Placebo","3":"108","4":"7","5":"5","6":"108","7":"1.00000000","8":"0.046296296","9":"100.0","10":"4.6","11":"Inf","12":"NA","13":"NA","14":"NA","15":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>k = 3
labs &lt;- c(&quot;Normal, not at all ill -   1&quot;,
          &quot;Normal to borderline ill - &lt;=2&quot;,
          &quot;Normal to mildly ill - &lt;=3&quot;)

p1 &lt;-
  ggplot(data = l[l$Category &lt;= k,], aes(x = `Cumulative %`, y = Category, col =
                                           Group)) +
  geom_point(size = 5) +
  facet_grid(rows = vars(Week)) +
  labs(title = &quot;Cumulative percentage of response&quot;, y = &quot;&quot;, x = &quot;&quot;) +
  scale_y_continuous(breaks = 1:k, labels = labs) +
  scale_x_continuous(limits = c(0, 100)) +
  theme_bw() +
  theme(legend.position = &quot;none&quot;,
        strip.text = element_blank()) +
  geom_text_repel(aes(label = paste(sprintf(
    &quot;%.1f&quot;, `Cumulative %`
  ), &quot;%&quot;)),
  nudge_y = 0.1)
p1</code></pre>
<p><img src="05-Plot-Forest-Plot_files/figure-html/unnamed-chunk-11-1.png" width="1152" /></p>
<pre class="r"><code>legend_b &lt;- get_legend(p1 +
                         guides(color = guide_legend(nrow = 1)) +
                         theme(legend.position = &quot;bottom&quot;,
                               legend.title = element_blank(),
                               legend.text = element_text(size = 12)))
p2 &lt;-
  ggplot(data = l[l$Category &lt;= k &amp;
                    !is.na(l$OR),], aes(x = OR, y = Category)) +
  geom_point(size = 3, pch = 15) +
  geom_linerange(aes(xmin = ORlower95CI, xmax = ORupper95CI)) +
  geom_vline(xintercept = 1, linetype = 3) +
  facet_grid(rows = vars(Week)) +
  scale_y_continuous(breaks = 1:k, labels = labs) +
  scale_x_continuous(limits = c(0, 6)) +
  theme_bw() +
  theme(legend.position = &quot;none&quot;,
        axis.text.y = element_blank()) +
  labs(x = &quot;&quot;, y=&quot;&quot;, title = &quot;OR (Active vs. Comparator)&quot;) +
  geom_text_repel(aes(label = sprintf(&quot;%.2f&quot;, OR)),
                  nudge_y = 0.1) +
  theme(strip.text = element_text(size=12))
p2</code></pre>
<p><img src="05-Plot-Forest-Plot_files/figure-html/unnamed-chunk-11-2.png" width="1152" /></p>
<pre class="r"><code>plot_row &lt;- plot_grid(p1, p2, nrow = 1, rel_widths = c(2, 1))

title &lt;- ggdraw() +
  draw_label(
    &quot;Active treatment is more effective than comparator at Week 52&quot;,
    fontface = &#39;bold&#39;,
    x = 0,
    hjust = 0,
    size = 24,
  ) +
  theme(plot.margin = margin(0, 0, 0, 7))

p &lt;- plot_grid(title,
               plot_row,
               legend_b,
               ncol = 1,
               rel_heights = c(0.1, 1, 0.05))
p</code></pre>
<p><img src="05-Plot-Forest-Plot_files/figure-html/unnamed-chunk-11-3.png" width="1152" /></p>
</div>
</div>
<div id="visualising-ranking-data" class="section level1">
<h1>Visualising Ranking Data</h1>
<p>To visualise ranking data resulting from a network meta-analysis
(NMA). The NMA synthesised the results of 11 trials comparing 12
treatments for major depression. The provided dataset consisted of the
probabilities that each treatment ranked in each position from Rank 1
(best) to Rank 12 (worst).</p>
<div id="lolly-plot" class="section level2">
<h2>Lolly plot</h2>
<p><img src="./02_Plots/Visualization/ForestPlot/Rank.png" /></p>
<pre><code>alpha &lt;- 0.10
dta &lt;- read.csv(&quot;./01_Datasets/bayesian_ranking.csv&quot;) %&gt;%
  pivot_longer(cols = -&quot;Treatment&quot;) %&gt;%
  mutate(
    rank = gsub(&quot;^Rank(.*)$&quot;, &quot;\\1&quot;, name),
    rank = factor(rank, levels = unique(rank[order(as.numeric(rank))])),
    rankx = as.numeric(rank)
  ) %&gt;%
  group_by(Treatment) %&gt;%
  mutate(
    lci = cumsum(value) &gt;= !!alpha / 2,
    uci = rev(cumsum(rev(value))) &gt;= !!alpha / 2,
    raw_value = value,
    value = (function(x) (x - min(x)) / (max(x) - min(x)))(value)
  ) %&gt;%
  mutate(avg = as.numeric(rank)[which.max(value)]) %&gt;%
  ungroup() %&gt;%
  mutate(
    Treatment = paste0(stringr::str_to_title(Treatment), &quot;:&quot;),
    Treatment = factor(Treatment, levels = unique(Treatment[order(avg)]))
  )

ci &lt;- dta %&gt;%
  group_by(Treatment) %&gt;%
  summarise(min = min(rankx[lci]), max = max(rankx[uci])) %&gt;%
  ungroup()

gg &lt;- ggplot(
  dta,
  aes(rankx, value, color = value, alpha = value, size = value)
) +
  geom_ribbon(
    aes(ymin = 0, ymax = value),
    fill = &quot;gray90&quot;, color = &quot;transparent&quot;, alpha = 1, size = 1
  ) +
  geom_hline(yintercept = 0, color = &quot;gray80&quot;, lwd = .1) +
  geom_segment(aes(xend = rankx, yend = 0), lwd = 1) +
  geom_point(shape = 21, fill = &quot;white&quot;, stroke = .5) +
  geom_point(shape = 21, fill = &quot;white&quot;, stroke = 0, alpha = 1) +
  geom_segment(
    data = ci,
    mapping = aes(x = min - 0.2, xend = max + 0.2, y = 0, yend = 0),
    color = &quot;gray20&quot;,
    alpha = 1,
    size = .25,
    arrow = arrow(angle = 90, ends = &quot;both&quot;, length = unit(0.1, &quot;lines&quot;))
  ) +
  scale_color_viridis_c(direction = -1, option = &quot;D&quot;, begin = .2, end = .8) +
  scale_x_continuous(breaks = 1:12) +
  scale_alpha_continuous(range = c(.3, 1)) +
  scale_size_continuous(range = c(.5, 2)) +
  xlab(&quot;Ranks&quot;) +
  facet_grid(Treatment ~ ., switch = &quot;y&quot;, scales = &quot;free&quot;) +
  coord_cartesian(clip = &quot;off&quot;) +
  guides(color = &quot;none&quot;, alpha = &quot;none&quot;, size = &quot;none&quot;) +
  theme_minimal() +
  theme(
    panel.grid = element_blank(),
    strip.text.y.left = element_text(
      margin = margin(b = 2, r = 5),
      angle = 0, vjust = 0,
      face = &quot;bold&quot;,
      color = &quot;gray30&quot;,
      size = 7
    ),
    panel.spacing.y = unit(.5, &quot;lines&quot;),
    axis.text.y = element_blank(),
    axis.text.x = element_text(margin = margin(t = 5, b = 5), size = 7),
    axis.title.x = element_text(color = &quot;gray40&quot;, size = 9),
    axis.title.y = element_blank()
  )

gg</code></pre>
<p>This plot uses lollipops to display the probability of a given
treatment ranking in each position. Rank is again displayed on the
x-axis and probability on the y-axis, although a separate sub-plot is
now produced for each treatment and stacked vertically. The ordering of
these subplots is logical, from the most effective treatment at the top
to the least effective treatment at the bottom, allowing the reader to
quickly establish the relative performance of each treatment. Lots of
visual elements are utilised in the plot, with the colour-gradient,
y-axis, point size and transparency all scaled to the treatment-wise
min-max-normalised NMA rank probabilities. The panel suggested that this
could result in some redundancy in the plot and that a subset of these
visual elements could be used to display key probability scales of
interest. Whilst the submitter acknowledges they have been produced by a
somewhat questionable algorithm in this instance, the panel appreciated
the inclusion of the credible intervals (shown by the horizontal black
lines under the lollipops), which add useful information to such plots
without adding significant clutter. Likewise, the inclusion of the
shaded grey background nicely displays how underlying distributions can
be displayed in such plots. The panel were extremely complimentary of
the aesthetics of the plot and all the little details that had been
considered to minimise clutter and produce an extremely clean display.
The main suggestion for improvement was to incorporate the absolute
probabilities somehow, perhaps with one of the several visual elements
used. Whilst the current scaled display makes within-treatment
comparison straightforward, it makes comparisons across treatments more
difficult. For instance, the rank 12 lollipop for Reboxetine is of
similar height to the Rank 11 lollipops for the three treatments above
it, despite us knowing from submission 1 that this probability is
clearly the largest observed for any treatment/rank.</p>
</div>
<div id="use-of-color-intensity" class="section level2">
<h2>Use of color intensity</h2>
<p>In the first, rank is displayed on the x-axis and treatment on the
y-axis, with the intensity of the colour used to display the probability
(ranging from 0=white to 1=red). The left-hand plot displays absolute
probability, whilst the right displays cumulative probability. The panel
appreciated the two different probabilities each being displayed,
suggesting they compliment one another. The cumulative probability plot
gives an area-under-the-curve like interpretation, providing a notion of
overall performance of the treatment. This could be further enhanced by
a logical ordering of the treatments, like seen in submission 2.
Similarly, some of the ‘cleaning’ seen in submission 2 would help remove
clutter from this plot, such as the background and gridlines. Whilst
aesthetically pleasing, the use of a colour gradient could cause
confusion as to the discrete nature of the ranks, since a smooth
gradient is displayed between each successive rank’s colour. This could
be circumvented with the use of a heatmap style display, with a distinct
cell displayed for each treatment and rank. The second half of the
submission displays the same information, but rather than having rank on
the x-axis, each rank corresponds to a concentric ring (with faceting
applied to distinguish treatments). This gives an aesthetically pleasing
plot that would be great for grabbing attention, although the
interpretation is less obvious than the previous plots. That being said,
the cumulative probability plots once again provide an
area-under-the-curve like interpretation which helps in assessing
relative performance (although once more a logical ordering of
treatments would support this). The panel highlighted that the main
challenge with such plots is that outer rings occupy much more space
than inner ones. This makes the worst performing treatment Reboxetine
stand out far more on the left-hand plot than the best performing
Mirtazapine. Inverting the ring ordering could be considered if wanting
to emphasise the best performing treatment.</p>
<pre class="r"><code># Read in packages
# require(gganimate)
# library(&quot;ggpubr&quot;)
# library(modelr)
# library(broom)
# library(grid)
# library(gridExtra)
# library(&quot;transformr&quot;)
# library(ggtext)
# library(&#39;ggforce&#39;) 

#data processing

# Set working directory using setwd()
rnk1 &lt;-  read.csv(&quot;./01_Datasets/bayesian_ranking.csv&quot;)
rnk2&lt;-tibble(rnk1)
rnk3 &lt;- mutate(rnk2, rowid_to_column(rnk2, &quot;ID&quot;))

rnk4 &lt;- rnk3 %&gt;%
  pivot_longer(!c(Treatment,ID), names_to = &quot;ranks&quot;, values_to = &quot;prop&quot;)
rnk5 &lt;- mutate(rnk4, ranker=str_replace_all(string=ranks, pattern=&quot;Rank&quot;, replacement=&quot;&quot;)) 
rnk6 &lt;- mutate(rnk5, rnk=as.numeric(ranker), r1=rnk-0.5, r2=rnk+0.5, p2=prop*12, rnkr=1/rnk, clr=letters[4])
rnk &lt;- rnk6 %&gt;% group_by(Treatment) %&gt;% mutate(cp=cumsum(prop))

#drawing

p&lt;-
ggplot() +
  ggforce::geom_link2(data = rnk,
                      aes(x = rnk, y = Treatment, color=clr, alpha = prop, size=5)) +
  #scale_colour_manual(values = &quot;green&quot;) +
  theme(legend.position=&quot;none&quot;) + 
  scale_x_discrete(name =&quot;Rank&quot;, limits=c(&#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;, &#39;10&#39;, &#39;11&#39;, &#39;12&#39;))
print(p)     </code></pre>
<p><img src="05-Plot-Forest-Plot_files/figure-html/unnamed-chunk-12-1.png" width="1152" /></p>
<pre class="r"><code>q&lt;-
ggplot() +
  ggforce::geom_link2(data = rnk,
                      aes(x = rnk, y = Treatment, colour=&#39;green&#39;, alpha = cp, size=5))  +
  #scale_colour_manual(values = &quot;green&quot;) +
  theme(legend.position=&quot;none&quot;) + 
  scale_x_discrete(name =&quot;Rank&quot;, limits=c(&#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;, &#39;10&#39;, &#39;11&#39;, &#39;12&#39;))
print(q)     </code></pre>
<p><img src="05-Plot-Forest-Plot_files/figure-html/unnamed-chunk-12-2.png" width="1152" /></p>
<pre class="r"><code>r1 &lt;- 
  ggplot(data = rnk, aes(x = factor(1), group=factor(rnkr), fill=p2)) +
  geom_bar(width = 1) +
  scale_fill_continuous(low=&#39;white&#39;, high=&#39;green1&#39;, guide=&quot;none&quot;) +
  facet_wrap(~Treatment, ncol=4) + theme(
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
  axis.text.x = element_blank(),
  axis.text.y = element_blank(),
  axis.ticks = element_blank())  
r1</code></pre>
<p><img src="05-Plot-Forest-Plot_files/figure-html/unnamed-chunk-12-3.png" width="1152" /></p>
<pre class="r"><code>r &lt;- r1 + coord_polar(theta = &quot;x&quot;)
print(r) </code></pre>
<p><img src="05-Plot-Forest-Plot_files/figure-html/unnamed-chunk-12-4.png" width="1152" /></p>
<pre class="r"><code>s1 &lt;- ggplot(data = rnk, aes(x = factor(1), group=factor(rnkr), fill=cp)) +
  geom_bar(width = 1) +
  scale_fill_continuous(low=&#39;white&#39;, high=&#39;green1&#39;, guide=&quot;none&quot;) +
  facet_wrap(~Treatment, ncol=4) + theme(
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks = element_blank())
s1</code></pre>
<p><img src="05-Plot-Forest-Plot_files/figure-html/unnamed-chunk-12-5.png" width="1152" /></p>
<pre class="r"><code>s&lt;- s1 + coord_polar(theta = &quot;x&quot;)
print(s)</code></pre>
<p><img src="05-Plot-Forest-Plot_files/figure-html/unnamed-chunk-12-6.png" width="1152" /></p>
</div>
<div id="treatment-ranking-dashboard" class="section level2">
<h2>Treatment Ranking Dashboard</h2>
<p><a href="https://huw-wilson.shinyapps.io/RankingDashboard/">App
1</a></p>
<p>On the left-hand side, a horizontal bar chart is displayed,
representing the SUCRA (surface under the cumulative ranking). A
description of this metric is provided, and this metric is used
consistently throughout to order plots for individual treatments from
best to worst, which the panel complimented. The user can select a
treatment of interest from a drop-down box, and this treatment is
highlighted in blue in all plots, with other treatments displayed in
grey and pushed to the background. This nicely highlights a treatment of
interest in a way that could be considered for enhancing submission 1.
On the right-hand side of the app, the user can explore a range of
plots. The first are line graphs and the user can select to display
either absolute or cumulative probabilities. By hovering over the plot,
the user can view the probability that each treatment ranks in each
position, meaning the entire underlying dataset can be recovered. This
feature can also be used to identify an interesting treatment from the
plot and subsequently select it from the drop-down box. The user can
either view all lines on a single plot select to display faceted plots
by treatment to make it easier to follow the line for a given treatment.
More could be done on these plots to emphasise the discrete nature of
the ranks, although the ability to hover and see the discrete
probabilities does go some way towards doing this. The user can also
select to view bar charts. These have probability on the x-axis and
allow the user to display whether to stack by treatment or by rank.
Depending on this selection, either treatment or rank is displayed on
the y-axis, with the other used to fill the stacked bars. This better
emphasises the discrete nature of the ranks than the line graphs and
allows the user to make both treatment-wise and rank-wise comparisons.
Small updates could further enhance this submission, such as widening
the extremes of the colour gradient on the bar charts. This would make
individual sections of the stacked bars easier to distinguish in the
presence of many treatments/ranks. Similarly, the consistent use of
colouring applied throughout the plots (blue for the selected
treatments, grey for the others), could be extended to legends and
labels to further strengthen the connection.</p>
<pre class="r"><code>shiny::includeHTML(&quot;./02_Plots/Visualization/ForestPlot/bayesian_ranking_lineup.html&quot;)</code></pre>
<pre><code>## Warning: `includeHTML()` was provided a `path` that appears to be a complete HTML document.
## ✖ Path: ./02_Plots/Visualization/ForestPlot/bayesian_ranking_lineup.html
## ℹ Use `tags$iframe()` to include an HTML document. You can either ensure `path` is accessible in your app or document (see e.g. `shiny::addResourcePath()`) and pass the relative path to the `src` argument. Or you can read the contents of `path` and pass the contents to `srcdoc`.</code></pre>
<!DOCTYPE html>
   <html>
   <head>
   <meta http-equiv="content-type" content="text/html; charset=UTF-8">
      <title>LineUp bayesian_ranking</title>
      <meta http-equiv="content-type" content="text/html; charset=UTF-8">
         <meta name="robots" content="noindex, nofollow">
            <meta name="googlebot" content="noindex, nofollow">
               <meta name="viewport" content="width=device-width, initial-scale=1">
                  
                  
                  <script
               type="text/javascript"
               src="/js/lib/dummy.js"
               
               ></script>
                  
                  <link rel="stylesheet" type="text/css" href="/css/result-light.css">
                  
                  <link rel="stylesheet" type="text/css" href="https://unpkg.com/lineupjs@4.0.0/build/LineUpJS.css">
                  <script type="text/javascript" src="https://unpkg.com/lineupjs@4.0.0/build/LineUpJS.js"></script>
                  <script type="text/javascript" src="https://unpkg.com/papaparse"></script>
                  
                  <style id="compiled-css" type="text/css">
                  .lu {
                     clear: both;
                     position: absolute;
                     top: 1px;
                     bottom: 0;
                     left: 0;
                     right: 0;
                     padding: 0;
                  }
               
               
               /* EOS */
                  </style>
                  
                  <script id="insert"></script>
                  
                  </head>
                  <body>
                  <script id="data" type="text/csv">Treatment,Rank1,Rank2,Rank3,Rank4,Rank5,Rank6,Rank7,Rank8,Rank9,Rank10,Rank11,Rank12
                  mirtazapine,0.555875,0.20725,0.122625,0.07775,0.024375,0.008875,0.001875,0.00075,0.000375,0.00025,0,0
                  escitalopram,0.256125,0.32825,0.225,0.13625,0.042375,0.010125,0.0015,0.00025,0.000125,0,0,0
                  venlafaxine,0.10775,0.25625,0.28875,0.24,0.079625,0.021625,0.0045,0.000875,5.00E-04,0.000125,0,0
                  sertraline,0.062875,0.167875,0.264125,0.318,0.12525,0.0425,0.0145,0.003625,0.00075,0.000375,0.000125,0
                  milnacipran,0.012,0.017625,0.029875,0.0425,0.09475,0.099,0.09875,0.090125,0.10725,0.146125,0.247125,0.014875
                  citalopram,0.00225,0.01075,0.0315,0.089375,0.26325,0.235875,0.15375,0.08725,0.060625,0.0465,0.018875,0
                  bupropion,0.002,0.005125,0.0195,0.050375,0.203,0.233875,0.1665,0.119375,0.088,0.069375,0.04225,0.000625
                  fluvoxamine,0.00075,0.004,0.008625,0.02025,0.0725,0.105125,0.10875,0.100625,0.126,0.17975,0.26575,0.007875
                  duloxetine,0.000375,0.00275,0.00925,0.02125,0.056,0.0905,0.117375,0.125625,0.130875,0.186125,0.2525,0.007375
                  fluoxetine,0,0,0,0.00025,0.00825,0.05175,0.146375,0.23825,0.25775,0.20775,0.089625,0
                  paroxetine,0,0.000125,0.00075,0.004,0.030625,0.10075,0.186,0.23275,0.226,0.161,0.057875,0.000125
                  reboxetine,0,0,0,0,0,0,0.000125,5.00E-04,0.00175,0.002625,0.025875,0.969125</script>
                  
                  <script id="dump" type="application/json">{
                     "$schema": "https://lineup.js.org/develop/schema.4.0.0.json",
                     "uid": 24,
                     "selection": [],
                     "aggregations": {},
                     "rankings": [
                        {
                           "columns": [
                              {
                                 "id": "col0",
                                 "desc": {
                                    "type":  "aggregate",
                                    "label": "Aggregate Groups",
                                    "fixed": true,
                                    "width": 40
                                 },
                                 "width": 40
                              },
                              {
                                 "id": "col1",
                                 "desc": {
                                    "type": "rank",
                                    "label": "Rank",
                                    "width": 50
                                 },
                                 "width": 50
                              },
                              {
                                 "id": "col2",
                                 "desc": "string@Treatment",
                                 "width": 200,
                                 "label": "TRT",
                                 "loaded": true,
                                 "filter": null,
                                 "groupCriteria": {
                                    "type": "startsWith",
                                    "values": []
                                 }
                              },
                              {
                                 "id": "col20",
                                 "desc": {
                                    "type": "stack",
                                    "label": "Weighted Sum",
                                    "renderer": "stack",
                                    "groupRenderer": "stack",
                                    "summaryRenderer": "default"
                                 },
                                 "width": 300,
                                 "label": "Top 3 Ranks (Weighted Sum)",
                                 "groupRenderer": "boxplot",
                                 "summaryRenderer": "default",
                                 "children": [
                                    {
                                       "id": "col3",
                                       "desc": "number@Rank1",
                                       "width": 100,
                                       "label": "R1",
                                       "groupRenderer": "boxplot",
                                       "summaryRenderer": "boxplot",
                                       "loaded": true,
                                       "map": {
                                          "type": "linear",
                                          "domain": [
                                             0,
                                             0.6
                                          ],
                                          "range": [
                                             0,
                                             1
                                          ]
                                       },
                                       "colorMapping": "#1f77b4",
                                       "filter": null,
                                       "groupSortMethod": "median",
                                       "stratifyThreshholds": []
                                    },
                                    {
                                       "id": "col4",
                                       "desc": "number@Rank2",
                                       "width": 100,
                                       "label": "R2",
                                       "groupRenderer": "boxplot",
                                       "summaryRenderer": "boxplot",
                                       "loaded": true,
                                       "map": {
                                          "type": "linear",
                                          "domain": [
                                             0,
                                             0.6
                                          ],
                                          "range": [
                                             0,
                                             1
                                          ]
                                       },
                                       "colorMapping": "#ff7f0e",
                                       "filter": null,
                                       "groupSortMethod": "median",
                                       "stratifyThreshholds": []
                                    },
                                    {
                                       "id": "col5",
                                       "desc": "number@Rank3",
                                       "width": 100,
                                       "label": "R3",
                                       "groupRenderer": "boxplot",
                                       "summaryRenderer": "boxplot",
                                       "loaded": true,
                                       "map": {
                                          "type": "linear",
                                          "domain": [
                                             0,
                                             0.6
                                          ],
                                          "range": [
                                             0,
                                             1
                                          ]
                                       },
                                       "colorMapping": "#2ca02c",
                                       "filter": null,
                                       "groupSortMethod": "median",
                                       "stratifyThreshholds": []
                                    }
                                 ],
                                 "collapsed": false
                              },
                              {
                                 "id": "col6",
                                 "desc": "number@Rank4",
                                 "width": 75,
                                 "label": "R4",
                                 "groupRenderer": "boxplot",
                                 "summaryRenderer": "boxplot",
                                 "loaded": true,
                                 "map": {
                                    "type": "linear",
                                    "domain": [
                                       0,
                                       0.6
                                    ],
                                    "range": [
                                       0,
                                       1
                                    ]
                                 },
                                 "colorMapping": "#999999",
                                 "filter": null,
                                 "groupSortMethod": "median",
                                 "stratifyThreshholds": []
                              },
                              {
                                 "id": "col7",
                                 "desc": "number@Rank5",
                                 "width": 75,
                                 "label": "R5",
                                 "groupRenderer": "boxplot",
                                 "summaryRenderer": "boxplot",
                                 "loaded": true,
                                 "map": {
                                    "type": "linear",
                                    "domain": [
                                       0,
                                       0.6
                                    ],
                                    "range": [
                                       0,
                                       1
                                    ]
                                 },
                                 "colorMapping": "#999999",
                                 "filter": null,
                                 "groupSortMethod": "median",
                                 "stratifyThreshholds": []
                              },
                              {
                                 "id": "col8",
                                 "desc": "number@Rank6",
                                 "width": 75,
                                 "label": "R6",
                                 "groupRenderer": "boxplot",
                                 "summaryRenderer": "boxplot",
                                 "loaded": true,
                                 "map": {
                                    "type": "linear",
                                    "domain": [
                                       0,
                                       0.6
                                    ],
                                    "range": [
                                       0,
                                       1
                                    ]
                                 },
                                 "colorMapping": "#999999",
                                 "filter": null,
                                 "groupSortMethod": "median",
                                 "stratifyThreshholds": []
                              },
                              {
                                 "id": "col9",
                                 "desc": "number@Rank7",
                                 "width": 75,
                                 "label": "R7",
                                 "groupRenderer": "boxplot",
                                 "summaryRenderer": "boxplot",
                                 "loaded": true,
                                 "map": {
                                    "type": "linear",
                                    "domain": [
                                       0,
                                       0.6
                                    ],
                                    "range": [
                                       0,
                                       1
                                    ]
                                 },
                                 "colorMapping": "#999999",
                                 "filter": null,
                                 "groupSortMethod": "median",
                                 "stratifyThreshholds": []
                              },
                              {
                                 "id": "col10",
                                 "desc": "number@Rank8",
                                 "width": 75,
                                 "label": "R8",
                                 "groupRenderer": "boxplot",
                                 "summaryRenderer": "boxplot",
                                 "loaded": true,
                                 "map": {
                                    "type": "linear",
                                    "domain": [
                                       0,
                                       0.6
                                    ],
                                    "range": [
                                       0,
                                       1
                                    ]
                                 },
                                 "colorMapping": "#999999",
                                 "filter": null,
                                 "groupSortMethod": "median",
                                 "stratifyThreshholds": []
                              },
                              {
                                 "id": "col11",
                                 "desc": "number@Rank9",
                                 "width": 75,
                                 "label": "R9",
                                 "groupRenderer": "boxplot",
                                 "summaryRenderer": "boxplot",
                                 "loaded": true,
                                 "map": {
                                    "type": "linear",
                                    "domain": [
                                       0,
                                       0.6
                                    ],
                                    "range": [
                                       0,
                                       1
                                    ]
                                 },
                                 "colorMapping": "#999999",
                                 "filter": null,
                                 "groupSortMethod": "median",
                                 "stratifyThreshholds": []
                              },
                              {
                                 "id": "col12",
                                 "desc": "number@Rank10",
                                 "width": 75,
                                 "label": "R10",
                                 "groupRenderer": "boxplot",
                                 "summaryRenderer": "boxplot",
                                 "loaded": true,
                                 "map": {
                                    "type": "linear",
                                    "domain": [
                                       0,
                                       0.6
                                    ],
                                    "range": [
                                       0,
                                       1
                                    ]
                                 },
                                 "colorMapping": "#999999",
                                 "filter": null,
                                 "groupSortMethod": "median",
                                 "stratifyThreshholds": []
                              },
                              {
                                 "id": "col13",
                                 "desc": "number@Rank11",
                                 "width": 75,
                                 "label": "R11",
                                 "groupRenderer": "boxplot",
                                 "summaryRenderer": "boxplot",
                                 "loaded": true,
                                 "map": {
                                    "type": "linear",
                                    "domain": [
                                       0,
                                       0.6
                                    ],
                                    "range": [
                                       0,
                                       1
                                    ]
                                 },
                                 "colorMapping": "#999999",
                                 "filter": null,
                                 "groupSortMethod": "median",
                                 "stratifyThreshholds": []
                              },
                              {
                                 "id": "col14",
                                 "desc": "number@Rank12",
                                 "width": 75,
                                 "label": "R12",
                                 "groupRenderer": "boxplot",
                                 "summaryRenderer": "boxplot",
                                 "loaded": true,
                                 "map": {
                                    "type": "linear",
                                    "domain": [
                                       0,
                                       0.99
                                    ],
                                    "range": [
                                       0,
                                       1
                                    ]
                                 },
                                 "colorMapping": "#999999",
                                 "filter": null,
                                 "groupSortMethod": "median",
                                 "stratifyThreshholds": []
                              },
                              {
                                 "id": "col23",
                                 "desc": {
                                    "type": "selection",
                                    "label": "Selection Checkboxes",
                                    "fixed": true,
                                    "width": 20
                                 },
                                 "width": 20,
                                 "loaded": true
                              }
                           ],
                           "sortCriteria": [
                              {
                                 "asc": false,
                                 "sortBy": "col20"
                              }
                           ],
                           "groupSortCriteria": [],
                           "groupColumns": [
                              "col23"
                           ]
                        }
                     ],
                     "showTopN": 12
                  }</script>
                  
                  <script type="text/javascript">//<![CDATA[
                     
                     const parsed = Papa.parse(document.querySelector('#data').textContent, {
                        dynamicTyping: true,
                        header: true,
                        skipEmptyLines: true
                     });
                     const dump = JSON.parse(document.querySelector('#dump').textContent);
                     
                     const lineup = LineUpJS
                     .builder(parsed.data)
                     .deriveColumns(parsed.meta.fields)
                     .deriveColors()
                     .rowHeight(35)
                     .sidePanel(0)
                     .restore(dump)
                     .build(document.body);
                     
                     //]]></script>
                  
                  <script>
                  // tell the embed parent frame the height of the content
               if (window.parent && window.parent.parent){
                  window.parent.parent.postMessage(["resultsFrame", {
                     height: document.body.getBoundingClientRect().height,
                     slug: "ts64f2zd"
                  }], "*")
               }
               
               // always overwrite window.name, in case users try to set it manually
               window.name = "result"
               </script>
                  
                  
                  </body>
                  </html>
                  
<p>This second dashboard comes with a range of interactive features to
help the user drive the display. Again, treatments are displayed on the
‘y-axis’ and ranks on the ‘x-axis’. Bars are displayed to indicate the
corresponding probability and are presented in such a way to emphasise
the discrete nature of the ranks. For the top 3 ranks, the probability
is displayed as a weighted sum. Although this may not be of the most
interest for this example and the choice of top 3 is somewhat arbitrary
here, one can easily imagine use cases where this would be an extremely
useful feature. Further, the user can assign the weights used in
computing this weighted sum (again, not the most directly relevant here
but certainly relevant in other use cases). Here, the weighted sum shows
an interesting message that a treatment could have a much higher
probability of being 1st specifically, but not necessarily have any/much
higher probability of being ranked in say the top 3. This can be seen
somewhat in cumulative probability plots from other submissions but is
most easily identified here. In addition to the bars, box plots are
displayed at the top of each column, displaying the distribution within
each rank. These highlight the contrasting behaviour of the extreme and
intermediate ranks, as seen in submission 1. Like the previous
dashboard, this one allows the user to view each individual probability
by hovering and goes further in providing selection boxes which can be
used to keep these probabilities displayed at all times. The app allows
the user to search for a treatment of interest and to sort the
visualization within/across ranks. This not only allows for a logical
ordering of treatments but allows the user to determine which ordering
they consider to be the most logical and display the visualization that
way.</p>
</div>
</div>
<div id="reference" class="section level1">
<h1>Reference</h1>
<ul>
<li><p>SIG (2024, Feb. 8). VIS-SIG Blog: Wonderful Wednesdays February
2024. Retrieved from <a
href="https://graphicsprinciples.github.io/posts/2024-09-01-wonderful-wednesdays-february-2024/"
class="uri">https://graphicsprinciples.github.io/posts/2024-09-01-wonderful-wednesdays-february-2024/</a></p></li>
<li><p>Warham (2023, March 8). VIS-SIG Blog: Wonderful Wednesdays March
2023. Retrieved from <a
href="https://graphicsprinciples.github.io/posts/2023-04-16-wonderful-wednesdays-march-2023/"
class="uri">https://graphicsprinciples.github.io/posts/2023-04-16-wonderful-wednesdays-march-2023/</a></p></li>
</ul>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
